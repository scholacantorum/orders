(function(t){function e(e){for(var r,i,s=e[0],c=e[1],u=e[2],d=0,f=[];d<s.length;d++)i=s[d],a[i]&&f.push(a[i][0]),a[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);l&&l(e);while(f.length)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,s=1;s<n.length;s++){var c=n[s];0!==a[c]&&(r=!1)}r&&(o.splice(e--,1),t=i(i.s=n[0]))}return t}var r={},a={"buy-tickets":0},o=[];function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;o.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("a2b0")},"23c60":function(t,e,n){"use strict";var r=n("d635"),a=n.n(r);a.a},"2a60":function(t,e,n){},"3e62":function(t,e,n){"use strict";var r=n("bfa3"),a=n.n(r);a.a},6398:function(t,e,n){"use strict";var r=n("2a60"),a=n.n(r);a.a},"7fae":function(t,e,n){},a2b0:function(t,e,n){"use strict";n.r(e);n("744f"),n("6095"),n("6c7b"),n("d25f"),n("7514"),n("20d6"),n("f3e2"),n("1c4c"),n("6762"),n("57e7"),n("2caf"),n("cadf"),n("9865"),n("6d67"),n("e804"),n("0cd8"),n("48f8"),n("759f"),n("55dd"),n("d04f"),n("78ce"),n("8ea5"),n("0298"),n("c8ce"),n("87b3"),n("d92a"),n("217b"),n("7f7f"),n("f400"),n("7f25"),n("536b"),n("d9ab"),n("f9ab"),n("32d7"),n("25c9"),n("9f3c"),n("042e"),n("c7c6"),n("f4ff"),n("049f"),n("7872"),n("a69f"),n("0b21"),n("6c1a"),n("c7c62"),n("84b4"),n("c5f6"),n("2e37"),n("fca0"),n("7cdf"),n("ee1d"),n("b1b1"),n("87f3"),n("9278"),n("5df2"),n("04ff"),n("f751"),n("8478"),n("4504"),n("fee7"),n("1c01"),n("58b2"),n("ffc1"),n("0d6d"),n("9986"),n("8e6e"),n("25db"),n("e4f7"),n("b9a1"),n("64d5"),n("9aea"),n("db97"),n("66c8"),n("57f0"),n("165b"),n("456d"),n("cf6a"),n("fd24"),n("8615"),n("551c"),n("097d"),n("df1b"),n("2397"),n("88ca"),n("ba16"),n("d185"),n("ebde"),n("2d34"),n("f6b3"),n("2251"),n("c698"),n("a19f"),n("9253"),n("9275"),n("3b2b"),n("3846"),n("4917"),n("a481"),n("28a5"),n("386d"),n("6b54"),n("4f7f"),n("8a81"),n("ac4d"),n("8449"),n("9c86"),n("fa83"),n("48c0"),n("a032"),n("aef6"),n("d263"),n("6c37"),n("9ec8"),n("5695"),n("2fdb"),n("d0b0"),n("5df3"),n("b54a"),n("f576"),n("ed50"),n("788d"),n("14b9"),n("f386"),n("f559"),n("1448"),n("673e"),n("242a"),n("4f37"),n("c66f"),n("262f"),n("b05c"),n("34ef"),n("6aa2"),n("15ac"),n("af56"),n("b6e4"),n("9c29"),n("63d9"),n("4dda"),n("10ad"),n("c02b"),n("4795"),n("130f"),n("ac6a"),n("96cf"),n("0cdd");var r=n("2b0e"),a=n("bc3a"),o=n.n(a),i={},s=o.a.create(i);s.interceptors.request.use(function(t){return t},function(t){return Promise.reject(t)}),s.interceptors.response.use(function(t){return t},function(t){return Promise.reject(t)}),Plugin.install=function(t){t.axios=s,window.axios=s,Object.defineProperties(t.prototype,{axios:{get:function(){return s}},$axios:{get:function(){return s}}})},r["default"].use(Plugin);Plugin;var c=n("9f7b");n("2dd8");r["default"].use(c["a"]);var u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.message?n("div",{domProps:{textContent:t._s(t.message)}}):t.products?n("div",[n("Dialog",{ref:"dialog",attrs:{products:t.products,title:t.title}}),n("b-btn",{attrs:{variant:"primary"},on:{click:t.onBuyTickets}},[t._v("Buy Tickets")])],1):t._e()},l=[],d=n("a34a"),f=n.n(d),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-modal",{ref:"modal",attrs:{title:t.title,"no-close-on-backdrop":"","hide-footer":""},on:{shown:t.onShown}},[t.orderID?n("Confirmation",{key:t.seq,attrs:{orderID:t.orderID},on:{close:t.onClose}}):n("OrderForm",{key:t.seq,ref:"form",attrs:{products:t.products},on:{success:t.onOrderSuccess}})],1)},p=[],b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._m(0),n("div",{attrs:{id:"connect-head"}},[t._v("Stay informed of Schola news!")]),n("div",[n("b-spinner",{directives:[{name:"show",rawName:"v-show",value:t.emailSpinner,expression:"emailSpinner"}],staticClass:"connect-done mt-1",attrs:{small:""}}),n("div",{directives:[{name:"show",rawName:"v-show",value:t.emailDone,expression:"emailDone"}],staticClass:"connect-done"},[t._v("✓")]),n("div",{staticClass:"connect-link",on:{click:t.onEmail}},[t._v("Subscribe to our email list")])],1),n("div",[n("div",{directives:[{name:"show",rawName:"v-show",value:t.facebookDone,expression:"facebookDone"}],staticClass:"connect-done"},[t._v("✓")]),n("div",{staticClass:"connect-link",on:{click:t.onFacebook}},[t._v("Follow us on Facebook")])]),n("div",[n("div",{directives:[{name:"show",rawName:"v-show",value:t.twitterDone,expression:"twitterDone"}],staticClass:"connect-done"},[t._v("✓")]),n("div",{staticClass:"connect-link",on:{click:t.onTwitter}},[t._v("Follow us on Twitter")])]),n("div",[n("b-btn",{attrs:{id:"connect-close",variant:"primary"},on:{click:function(e){return t.$emit("close")}}},[t._v("Close")])],1)])},h=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"ticket-confirm"}},[t._v("Thank you.  We have received your payment and emailed your\nticket. "),n("span",{attrs:{id:"ticket-reminder"}},[t._v("Please bring it with\nyou")]),t._v(" (printed or on phone) for admission.")])}];function v(t,e,n,r,a,o,i){try{var s=t[o](i),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,a)}function y(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var o=t.apply(e,n);function i(t){v(o,r,a,i,s,"next",t)}function s(t){v(o,r,a,i,s,"throw",t)}i(void 0)})}}var w,g={props:{orderID:Number},data:function(){return{emailDone:!1,emailSpinner:!1,facebookDone:!1,twitterDone:!1}},methods:{onEmail:function(){var t=y(f.a.mark(function t(){var e;return f.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.emailDone){t.next=2;break}return t.abrupt("return");case 2:return this.emailSpinner=!0,t.next=5,this.$axios.post("/backend/email-signup?order=".concat(this.orderID)).catch(function(t){return console.error(t),null});case 5:if(e=t.sent,e){t.next=8;break}return t.abrupt("return");case 8:e.status<400?this.emailDone=!0:console.error(e.statusText);case 9:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),onFacebook:function(){window.open("https://www.facebook.com/scholacantorum.org","_blank"),this.facebookDone=!0},onTwitter:function(){window.open("https://twitter.com/scholacantorum1","_blank"),this.twitterDone=!0}}},k=g,_=(n("6398"),n("2877")),x=Object(_["a"])(k,b,h,!1,null,null,null),C=x.exports,S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-form",{attrs:{novalidate:""},on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[n("b-container",{staticClass:"px-0",attrs:{fluid:""}},[n("b-form-group",{staticClass:"mb-0",attrs:{label:"Ticket Quantities","label-sr-only":"",state:t.quantityState,"invalid-feedback":"How many tickets do you want?"}},[n("table",{attrs:{id:"buy-tickets-form-quantities"}},t._l(t.order.lines,function(e){return n("QtyRow",{key:e.product,ref:"qty",refInFor:!0,attrs:{name:e.productName,message:e.message,price:e.price,valid:t.quantityState},model:{value:e.quantity,callback:function(n){t.$set(e,"quantity",n)},expression:"ol.quantity"}})}),1)]),n("DonationRow",{model:{value:t.donation,callback:function(e){t.donation=e},expression:"donation"}}),n("TotalRow",{attrs:{total:t.total}}),n("div",{attrs:{id:"buy-tickets-form-divider"}}),n("b-form-group",{staticClass:"mb-1",attrs:{label:"Your name","label-sr-only":"",state:t.nameState,"invalid-feedback":"Please enter your name."}},[n("b-form-input",{attrs:{placeholder:"Your name"},model:{value:t.order.name,callback:function(e){t.$set(t.order,"name","string"===typeof e?e.trim():e)},expression:"order.name"}})],1),n("b-form-group",{staticClass:"mb-1",attrs:{label:"Email address","label-sr-only":"",state:t.emailState,"invalid-feedback":t.order.email?"This is not a valid email address.":"Please enter your email address."}},[n("b-form-input",{attrs:{type:"email",placeholder:"Email address"},on:{focus:function(e){t.emailFocused=!0},blur:function(e){t.emailFocused=!1}},model:{value:t.order.email,callback:function(e){t.$set(t.order,"email","string"===typeof e?e.trim():e)},expression:"order.email"}})],1),n("b-form-group",{staticClass:"mb-1",attrs:{label:"Card number","label-sr-only":"",state:!t.cardError&&null,"invalid-feedback":t.cardError}},[n("div",{ref:"card",staticClass:"form-control",attrs:{id:"buy-tickets-form-card"}})]),n("div",{attrs:{id:"buy-tickets-form-footer"}},[t.message?n("div",{attrs:{id:"buy-tickets-form-message"},domProps:{textContent:t._s(t.message)}}):t._e(),n("div",{attrs:{id:"buy-tickets-form-buttons"}},[n("b-btn",{attrs:{type:"button",variant:"secondary",disabled:t.submitting}},[t._v("Cancel")]),t.submitting?n("b-btn",{attrs:{id:"buy-tickets-form-pay-now",type:"submit",variant:"primary",disabled:""}},[n("b-spinner",{staticClass:"mr-1",attrs:{small:""}}),t._v("Paying...")],1):n("b-btn",{attrs:{id:"buy-tickets-form-pay-now",type:"submit",variant:"primary"}},[t._v("Pay Now")])],1)])],1)],1)},P=[],$=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("table",{attrs:{id:"buy-tickets-donation-row"}},[n("tr",[n("td",{attrs:{id:"buy-tickets-donation-label"}},[t._v("Add a donation to your order?")]),n("td",{attrs:{id:"buy-tickets-donation-amount-cell"}},[t._v("$"),n("b-form-input",{attrs:{id:"buy-tickets-donation-amount",value:t.value||"",type:"number",placeholder:"0",min:"0"},on:{input:function(e){t.$emit("input",Math.max(parseInt(e)||0),0)}}})],1)])])},q=[],D={props:{value:Number}},O=D,E=(n("d113"),Object(_["a"])(O,$,q,!1,null,null,null)),j=E.exports,F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tr",{staticClass:"buy-tickets-qty-row"},[t.message?[n("td",{staticClass:"buy-tickets-qty-row-name",domProps:{textContent:t._s(t.name)}}),t.message?n("td",{staticClass:"buy-tickets-qty-row-message",attrs:{colspan:"4"},domProps:{textContent:t._s(t.message)}}):t._e()]:[n("td",{staticClass:"buy-tickets-qty-row-name",attrs:{colspan:"2"},domProps:{textContent:t._s(t.name)}}),n("td",{staticClass:"buy-tickets-qty-row-qty-cell"},[n("b-form-input",{ref:"input",staticClass:"buy-tickets-qty-row-qty",attrs:{value:t.value||"",state:t.valid,type:"number",placeholder:"0",min:"0"},on:{input:function(e){t.$emit("input",Math.max(parseInt(e)||0),0)}}})],1),n("td",{staticClass:"buy-tickets-qty-row-price"},[t._v("×$"+t._s(t.price/100))]),n("td",{staticClass:"buy-tickets-qty-row-amount",domProps:{textContent:t._s(t.value?"$"+t.price*t.value/100:"")}})]],2)},T=[],A={props:{autofocus:Boolean,message:String,name:String,price:Number,value:Number,valid:Boolean},methods:{focus:function(){this.$refs.input.focus()},onQtyChange:function(t){this.$emit("input",parseInt(t.target.value)||0)}}},I=A,N=(n("3e62"),Object(_["a"])(I,F,T,!1,null,null,null)),M=N.exports,z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"buy-tickets-form-total-row"}},[n("div",{attrs:{id:"buy-tickets-form-total"},domProps:{textContent:t._s("$"+t.total/100)}})])},R=[],Z={props:{total:Number}},B=Z,Q=(n("b5ea"),Object(_["a"])(B,z,R,!1,null,null,null)),W=Q.exports;function J(t,e,n,r,a,o,i){try{var s=t[o](i),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,a)}function G(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var o=t.apply(e,n);function i(t){J(o,r,a,i,s,"next",t)}function s(t){J(o,r,a,i,s,"throw",t)}i(void 0)})}}var H={components:{DonationRow:j,QtyRow:M,TotalRow:W},props:{products:Array,title:String},data:function(){return{card:null,cardChange:null,cardFocus:!1,donation:0,elements:null,emailFocused:!1,message:null,order:{name:"",email:"",lines:[]},submitted:!1,submitting:!1}},watch:{products:{immediate:!0,handler:"createOrder"}},mounted:function(){var t=this;w||(w=Stripe("pk_test_QPwvhWbGaakWn7DGcco8J5Nd")),this.elements=w.elements(),this.card=this.elements.create("card",{style:{base:{fontSize:"16px",lineHeight:1.5}}}),this.$nextTick(function(){t.card.mount(t.$refs.card),t.card.on("change",t.onCardChange),t.card.on("focus",function(){t.cardFocus=!0}),t.card.on("blur",function(){t.cardFocus=!1})})},computed:{cardError:function(){return this.cardChange&&this.cardChange.error?this.cardChange.error.message:this.submitted?!this.cardChange||this.cardChange.empty?"Please enter your card number.":this.cardFocus||this.cardChange.complete?null:"This card number is incomplete.":null},emailState:function(){return!(!this.emailFocused&&this.order.email&&!this.order.email.match(/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/))&&(!(this.submitted&&!this.order.email)&&null)},nameState:function(){return(!this.submitted||""!=this.order.name)&&null},quantityState:function(){return this.submitted?!!this.order.lines.some(function(t){return t.quantity})&&null:null},total:function(){return this.order.lines.reduce(function(t,e){return t+e.quantity*(e.price||0)},0)+100*this.donation}},methods:{createOrder:function(){var t=this;if(this.products){var e,n=0;this.order.lines=[],this.products.forEach(function(r){t.order.lines.push({product:r.id,productName:r.name,message:r.message,price:r.price,quantity:0}),r.message||(n++,e=t.order.lines[t.order.lines.length-1])}),1===n&&(e.quantity=1)}},onCardChange:function(t){this.cardChange=t},onSubmit:function(){var t=G(f.a.mark(function t(){var e,n,r,a;return f.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.submitted=!0,null===this.quantityState&&null===this.nameState&&null===this.emailState&&!this.cardError){t.next=3;break}return t.abrupt("return");case 3:return this.submitting=!0,t.next=6,w.createPaymentMethod("card",this.card,{billing_details:{name:this.order.name,email:this.order.email}});case 6:if(e=t.sent,n=e.paymentMethod,r=e.error,!r){t.next=14;break}return console.error(r),this.submitting=!1,"card_error"===r.type||"validation_error"===r.type?this.message=r.message:this.message="We’re sorry, but we're unable to process payment cards at the moment.  Please try again later, or call our office at (650) 254-1700 to order by phone.",t.abrupt("return");case 14:return t.next=16,this.$axios.post("".concat("http://localhost:8100","/api/order"),JSON.stringify({source:"public",name:this.order.name,email:this.order.email,lines:this.order.lines.filter(function(t){return t.quantity&&!t.message}).map(function(t){return{product:t.product,quantity:t.quantity,price:t.price}}),payments:[{type:"card",method:n.id,amount:this.total}]})).catch(function(t){return t});case 16:a=t.sent,this.submitting=!1,a&&a.data&&a.data.id?this.$emit("success",a.data.id):a&&a.data&&a.data.error?this.message=a.data.error:(console.error(a),this.message="We’re sorry, but we're unable to process payment cards at the moment.  Please try again later, or call our office at (650) 254-1700 to order by phone.");case 19:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),setAutoFocus:function(){this.$refs.qty[0].focus()}}},L=H,Y=(n("23c60"),Object(_["a"])(L,S,P,!1,null,null,null)),U=Y.exports,K={components:{Confirmation:C,OrderForm:U},props:{products:Array,title:String},data:function(){return{orderID:null,seq:0}},methods:{onClose:function(){this.$refs.modal.hide()},onOrderSuccess:function(t){this.orderID=t},onShown:function(){this.$refs.form.setAutoFocus()},show:function(){this.seq++,this.orderID=null,this.$refs.modal.show()}}},V=K,X=Object(_["a"])(V,m,p,!1,null,null,null),tt=X.exports;function et(t){return et="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},et(t)}function nt(t,e,n,r,a,o,i){try{var s=t[o](i),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,a)}function rt(t){return function(){var e=this,n=arguments;return new Promise(function(r,a){var o=t.apply(e,n);function i(t){nt(o,r,a,i,s,"next",t)}function s(t){nt(o,r,a,i,s,"throw",t)}i(void 0)})}}var at={props:{productIDs:Array,title:String},components:{Dialog:tt},data:function(){return{coupon:"",couponMatch:!0,message:null,products:null}},mounted:function(){var t=rt(f.a.mark(function t(){var e,n;return f.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=new URLSearchParams,this.productIDs.forEach(function(t){e.append("p",t)}),t.prev=2,t.next=5,this.$axios({method:"GET",url:"".concat("http://localhost:8100","/api/prices"),params:e});case 5:n=t.sent.data,t.next=12;break;case 8:return t.prev=8,t.t0=t["catch"](2),console.error(t.t0),t.abrupt("return");case 12:"string"===typeof n&&(this.message=n),"object"===et(n)&&(this.products=n.products,this.couponMatch=n.coupon);case 14:case"end":return t.stop()}},t,this,[[2,8]])}));function e(){return t.apply(this,arguments)}return e}(),methods:{onBuyTickets:function(){this.$refs.dialog.show()}}},ot=at,it=Object(_["a"])(ot,u,l,!1,null,null,null),st=it.exports;r["default"].config.productionTip=!1,window.addEventListener("load",function(){var t=document.getElementsByClassName("buy-tickets"),e=function(){var e=t[0],n=e.getAttribute("data-products").split(" ");new r["default"]({render:function(t){return t(st,{props:{title:e.getAttribute("data-title"),productIDs:n}})}}).$mount(e)};while(t.length)e()})},b5ea:function(t,e,n){"use strict";var r=n("f7ff"),a=n.n(r);a.a},bfa3:function(t,e,n){},d113:function(t,e,n){"use strict";var r=n("7fae"),a=n.n(r);a.a},d635:function(t,e,n){},f7ff:function(t,e,n){}});
//# sourceMappingURL=buy-tickets.46885445.js.map
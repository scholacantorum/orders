(function(t){function e(e){for(var r,i,o=e[0],u=e[1],c=e[2],p=0,l=[];p<o.length;p++)i=o[p],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&l.push(s[i][0]),s[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);d&&d(e);while(l.length)l.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],r=!0,o=1;o<n.length;o++){var u=n[o];0!==s[u]&&(r=!1)}r&&(a.splice(e--,1),t=i(i.s=n[0]))}return t}var r={},s={recordings:0},a=[];function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var d=u;a.push([2,"chunk-vendors"]),n()})({"135e":function(t,e,n){"use strict";var r=n("2b0e"),s=n("5f5b");n("2dd8");r["default"].use(s["a"])},2:function(t,e,n){t.exports=n("cfa8")},"4cab":function(t,e,n){},6144:function(t,e,n){"use strict";var r=n("bf70"),s=n.n(r);s.a},ace5:function(t,e,n){"use strict";var r=n("ad29"),s=n.n(r);s.a},ad29:function(t,e,n){},be3b:function(t,e,n){"use strict";var r=n("2b0e"),s=n("bc3a"),a=n.n(s),i={},o=a.a.create(i);o.interceptors.request.use((function(t){return t}),(function(t){return Promise.reject(t)})),o.interceptors.response.use((function(t){return t}),(function(t){return Promise.reject(t)})),Plugin.install=function(t){t.axios=o,window.axios=o,Object.defineProperties(t.prototype,{axios:{get:function(){return o}},$axios:{get:function(){return o}}})},r["default"].use(Plugin);Plugin},bf70:function(t,e,n){},cfa8:function(t,e,n){"use strict";n.r(e);n("744f"),n("6095"),n("6c7b"),n("d25f"),n("7514"),n("20d6"),n("f3e2"),n("1c4c"),n("6762"),n("57e7"),n("2caf"),n("cadf"),n("9865"),n("6d67"),n("e804"),n("0cd8"),n("48f8"),n("759f"),n("55dd"),n("d04f"),n("78ce"),n("8ea5"),n("0298"),n("c8ce"),n("87b3"),n("d92a"),n("217b"),n("7f7f"),n("f400"),n("7f25"),n("536b"),n("d9ab"),n("f9ab"),n("32d7"),n("25c9"),n("9f3c"),n("042e"),n("c7c6"),n("f4ff"),n("049f"),n("7872"),n("a69f"),n("0b21"),n("6c1a"),n("c7c62"),n("84b4"),n("c5f6"),n("2e37"),n("fca0"),n("7cdf"),n("ee1d"),n("b1b1"),n("87f3"),n("9278"),n("5df2"),n("04ff"),n("f751"),n("8478"),n("4504"),n("fee7"),n("1c01"),n("58b2"),n("ffc1"),n("0d6d"),n("9986"),n("8e6e"),n("25db"),n("e4f7"),n("b9a1"),n("64d5"),n("9aea"),n("db97"),n("66c8"),n("57f0"),n("165b"),n("456d"),n("cf6a"),n("fd24"),n("8615"),n("551c"),n("097d"),n("df1b"),n("2397"),n("88ca"),n("ba16"),n("d185"),n("ebde"),n("2d34"),n("f6b3"),n("2251"),n("c698"),n("a19f"),n("9253"),n("9275"),n("3b2b"),n("3846"),n("4917"),n("a481"),n("28a5"),n("386d"),n("6b54"),n("4f7f"),n("8a81"),n("ac4d"),n("8449"),n("9c86"),n("fa83"),n("48c0"),n("a032"),n("aef6"),n("d263"),n("6c37"),n("9ec8"),n("5695"),n("2fdb"),n("d0b0"),n("5df3"),n("b54a"),n("f576"),n("ed50"),n("788d"),n("14b9"),n("f386"),n("f559"),n("1448"),n("673e"),n("242a"),n("4f37"),n("c66f"),n("262f"),n("b05c"),n("34ef"),n("6aa2"),n("15ac"),n("af56"),n("b6e4"),n("9c29"),n("63d9"),n("4dda"),n("10ad"),n("c02b"),n("4795"),n("130f"),n("ac6a"),n("96cf"),n("0cdd");var r,s=n("2b0e"),a=(n("be3b"),n("135e"),n("ab8b"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Dialog",{ref:"dialog",attrs:{auth:t.auth,products:t.products,stripeKey:t.stripeKey,user:t.user},on:{close:t.onClose,success:t.onSuccess}})}),i=[],o=n("a34a"),u=n.n(o),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-modal",{ref:"modal",attrs:{title:"Concert Recordings","no-close-on-backdrop":"","hide-footer":""},on:{shown:t.onShown,hide:t.onHide}},[n("OrderForm",{key:t.seq,ref:"form",attrs:{auth:t.auth,products:t.products,stripeKey:t.stripeKey,user:t.user},on:{success:t.onOrderSuccess,cancel:t.onClose,submitting:t.onSubmitting}})],1)},d=[],p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-form",{attrs:{novalidate:""},on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[n("OrderLines",{attrs:{products:t.products}}),n("OrderPayment",{ref:"pmt",attrs:{send:t.onSend,stripeKey:t.stripeKey,total:t.total,user:t.user},on:{cancel:t.onCancel,submitted:t.onSubmitted,submitting:t.onSubmitting}})],1)},l=[],f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",{staticClass:"px-0 mb-3",attrs:{fluid:""}},[n("b-form-group",{staticClass:"mb-0"},[n("table",{attrs:{id:"recordings-form-quantities"}},t._l(t.products,(function(e){return n("tr",{key:e.id,staticClass:"recordings-qty-row"},[n("td",{staticClass:"recordings-qty-row-name",domProps:{textContent:t._s(e.name)}}),n("td",{staticClass:"recordings-qty-row-amount",domProps:{textContent:t._s("$"+e.price/100)}})])})),0)]),t.products.length>1?n("div",{attrs:{id:"recordings-form-total-row"}},[n("div",{attrs:{id:"recordings-form-total"},domProps:{textContent:t._s("$"+t.total/100)}})]):t._e()],1)},h=[],m={props:{products:Array},computed:{total:function(){return this.products.reduce((function(t,e){return t+e.price}),0)}}},b=m,y=(n("db0d"),n("2877")),g=Object(y["a"])(b,f,h,!1,null,null,null),v=g.exports,w=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:null!==t.canPR,expression:"canPR !== null"}],attrs:{id:"recordings-form-payment"}},[t.canPR?n("div",{attrs:{id:"recordings-form-use-pr-div"}},[n("label",{attrs:{id:"recordings-form-use-pr-label",for:"recordings-form-use-pr"}},[t._v("Use payment info saved "+t._s(t.deviceOrBrowser)+"?")]),n("b-form-checkbox",{attrs:{id:"recordings-form-use-pr",switch:""},model:{value:t.usePR,callback:function(e){t.usePR=e},expression:"usePR"}})],1):t._e(),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.usePR,expression:"!usePR"}]},[n("b-form-group",{staticClass:"mb-1",attrs:{label:"Card number","label-sr-only":"",state:!t.cardError&&null,"invalid-feedback":t.cardError}},[n("div",{ref:"card",staticClass:"form-control",attrs:{id:"recordings-form-card"}})])],1),n("div",{attrs:{id:"recordings-form-footer"}},[t.message?n("div",{attrs:{id:"recordings-form-message"},domProps:{textContent:t._s(t.message)}}):t._e(),n("div",{attrs:{id:"recordings-form-buttons"}},[n("b-btn",{attrs:{type:"button",variant:"secondary",disabled:t.submitting},on:{click:t.onCancel}},[t._v("Cancel")]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.usePR,expression:"usePR"}],ref:"prbutton",attrs:{id:"recordings-form-prbutton"}}),!t.usePR&&t.submitting?n("b-btn",{attrs:{id:"recordings-form-pay-now",type:"submit",variant:"primary",disabled:""}},[n("b-spinner",{staticClass:"mr-1",attrs:{small:""}}),t._v("Paying...")],1):t._e(),t.usePR||t.submitting?t._e():n("b-btn",{attrs:{id:"recordings-form-pay-now",type:"submit",variant:"primary"}},[t._v("Pay "+t._s(t.total?"$"+t.total/100:"Now"))])],1)])])},P=[];function x(t,e,n,r,s,a,i){try{var o=t[a](i),u=o.value}catch(c){return void n(c)}o.done?e(u):Promise.resolve(u).then(r,s)}function C(t){return function(){var e=this,n=arguments;return new Promise((function(r,s){var a=t.apply(e,n);function i(t){x(a,r,s,i,o,"next",t)}function o(t){x(a,r,s,i,o,"throw",t)}i(void 0)}))}}var _={props:{send:Function,stripeKey:String,total:Number,user:Object},data:function(){return{canPR:null,card:null,cardChange:null,cardFocus:!1,elements:null,message:null,payreq:null,prbutton:null,submitted:!1,submitting:!1,usePR:!1}},mounted:function(){var t=C(u.a.mark((function t(){var e=this;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r||(r=Stripe(this.stripeKey)),this.elements=r.elements(),this.card=this.elements.create("card",{style:{base:{fontSize:"16px",lineHeight:1.5}},hidePostalCode:!0}),this.card.on("change",this.onCardChange),this.card.on("focus",(function(){e.cardFocus=!0})),this.card.on("blur",(function(){e.cardFocus=!1})),this.$nextTick((function(){e.card.mount(e.$refs.card)})),this.payreq=r.paymentRequest({country:"US",currency:"usd",total:{label:"Schola Cantorum Recording Order",amount:this.total},requestPayerName:!0,requestPayerEmail:!0}),t.next=10,this.payreq.canMakePayment();case 10:this.canPR=!!t.sent,this.canPR&&(this.usePR=!0,this.payreq.on("paymentmethod",this.onPaymentMethod),this.prbutton=this.elements.create("paymentRequestButton",{paymentRequest:this.payreq}),this.prbutton.on("click",this.onPRButtonClick),this.$nextTick((function(){e.prbutton.mount(e.$refs.prbutton)})));case 12:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),computed:{cardError:function(){return this.cardChange&&this.cardChange.error?this.cardChange.error.message:this.submitted?!this.cardChange||this.cardChange.empty?"Please enter your card number.":this.cardFocus||this.cardChange.complete?null:"This card number is incomplete.":null},deviceOrBrowser:function(){var t=navigator.userAgent||navigator.vendor;return/android|ipad|iphone|ipod|windows phone/i.test(t)?"on device":"in browser"}},watch:{submitted:function(){this.submitted&&this.$emit("submitted")},submitting:function(){this.$emit("submitting",this.submitting)},usePR:function(){this.submitted=!1}},methods:{focus:function(){},onCancel:function(){this.$emit("cancel")},onCardChange:function(t){this.cardChange=t},onPaymentMethod:function(){var t=C(u.a.mark((function t(e){var n;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.submitting=!0,this.card.update({disabled:!0}),t.next=4,this.send({subtype:"API ".concat(e.methodName),method:e.paymentMethod.id});case 4:n=t.sent,this.submitting=!1,this.card.update({disabled:!1}),n&&(this.message=n),e.complete(n?"fail":"success");case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),onPRButtonClick:function(){this.submitted=!0,this.message=null},submit:function(){var t=C(u.a.mark((function t(){var e,n,s,a;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==this.canPR&&!this.usePR){t.next=2;break}return t.abrupt("return");case 2:if(this.submitted=!0,this.message=null,!this.cardError){t.next=6;break}return t.abrupt("return");case 6:return this.submitting=!0,this.card.update({disabled:!0}),t.next=10,r.createPaymentMethod("card",this.card,{billing_details:{name:this.user.name,email:this.user.email,address:{line1:this.user.address,city:this.user.city,state:this.user.state,postal_code:this.user.zip}}});case 10:if(e=t.sent,n=e.paymentMethod,s=e.error,!s){t.next=19;break}return console.error(s),this.submitting=!1,this.card.update({disabled:!1}),"card_error"===s.type||"validation_error"===s.type?this.message=s.message:this.message="We’re sorry, but we're unable to process payment cards at the moment.  Please try again later, or call our office at (650) 254-1700 to order by phone.",t.abrupt("return");case 19:return t.next=21,this.send({subtype:"manual",method:n.id});case 21:a=t.sent,this.submitting=!1,this.card.update({disabled:!1}),a&&(this.message=a);case 25:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},S=_,O=(n("ea72"),Object(y["a"])(S,w,P,!1,null,null,null)),$=O.exports;function R(t,e,n,r,s,a,i){try{var o=t[a](i),u=o.value}catch(c){return void n(c)}o.done?e(u):Promise.resolve(u).then(r,s)}function k(t){return function(){var e=this,n=arguments;return new Promise((function(r,s){var a=t.apply(e,n);function i(t){R(a,r,s,i,o,"next",t)}function o(t){R(a,r,s,i,o,"throw",t)}i(void 0)}))}}var q={components:{OrderLines:v,OrderPayment:$},props:{auth:String,products:Array,stripeKey:String,user:Object},data:function(){return{submitted:!1,submitting:!1}},computed:{lines:function(){return this.products.map((function(t){return{product:t.id,price:t.price,quantity:1}}))},total:function(){return this.lines?this.lines.reduce((function(t,e){return t+e.quantity*(e.price||0)}),0):null}},watch:{submitting:function(){this.$emit("submitting",this.submitting)}},methods:{onCancel:function(){this.$emit("cancel")},onSubmit:function(){this.$refs.pmt.submit()},onSubmitted:function(){this.submitted=!0},onSubmitting:function(t){this.submitting=t},onSend:function(){var t=k(u.a.mark((function t(e){var n,r,s,a;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.subtype,r=e.method,s=new FormData,s.append("source","members"),s.append("name",this.user.name),s.append("email",this.user.email),s.append("address",this.user.address),s.append("city",this.user.city),s.append("state",this.user.state),s.append("zip",this.user.zip),s.append("member",this.user.id),this.lines.filter((function(t){return t.quantity&&!t.message})).forEach((function(t,e){var n="line".concat(e+1);s.append("".concat(n,".product"),t.product),s.append("".concat(n,".quantity"),t.quantity),s.append("".concat(n,".price"),t.price)})),s.append("payment1.type","card"),s.append("payment1.subtype",n),s.append("payment1.method",r),s.append("payment1.amount",this.total),t.next=17,this.$axios.post("/payapi/order?auth=".concat(encodeURIComponent(this.auth)),s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).catch((function(t){return t}));case 17:if(a=t.sent,!(a&&a.data&&a.data.id)){t.next=21;break}return this.$emit("success",a.data.id),t.abrupt("return",null);case 21:if(!(a&&a.data&&a.data.error)){t.next=23;break}return t.abrupt("return",a.data.error);case 23:return console.error(a),t.abrupt("return","We’re sorry, but we're unable to process payment cards at the moment.  Please try again later, or call our office at (650) 254-1700 to order by phone.");case 25:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),setAutoFocus:function(){this.$refs.pmt.focus()}}},j=q,E=(n("6144"),Object(y["a"])(j,p,l,!1,null,null,null)),K=E.exports,M={components:{OrderForm:K},props:{auth:String,products:Array,stripeKey:String,user:Object},data:function(){return{seq:0,submitting:!1}},methods:{onClose:function(){this.$refs.modal.hide()},onHide:function(t){this.submitting&&t.preventDefault(),this.$emit("close")},onOrderSuccess:function(t){this.submitting=!1,this.$emit("success",t)},onShown:function(){this.$refs.form.setAutoFocus()},onSubmitting:function(t){this.submitting=t},show:function(){this.seq++,this.orderID=null,this.$refs.modal.show()}}},F=M,A=Object(y["a"])(F,c,d,!1,null,null,null),D=A.exports;function T(t,e,n,r,s,a,i){try{var o=t[a](i),u=o.value}catch(c){return void n(c)}o.done?e(u):Promise.resolve(u).then(r,s)}function N(t){return function(){var e=this,n=arguments;return new Promise((function(r,s){var a=t.apply(e,n);function i(t){T(a,r,s,i,o,"next",t)}function o(t){T(a,r,s,i,o,"throw",t)}i(void 0)}))}}var I={props:{productIDs:Array,auth:String},components:{Dialog:D},data:function(){return{products:null,stripeKey:null,user:null}},mounted:function(){var t=N(u.a.mark((function t(){var e,n,r=this;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=new URLSearchParams,this.productIDs.forEach((function(t){e.append("p",t)})),e.append("auth",this.auth),e.append("source","members"),t.prev=4,t.next=7,this.$axios({method:"GET",url:"/payapi/prices",params:e});case 7:n=t.sent.data,t.next=15;break;case 10:return t.prev=10,t.t0=t["catch"](4),console.error(t.t0),window.parent.postMessage("close","*"),t.abrupt("return");case 15:this.products=n.products,this.stripeKey=n.stripePublicKey,this.user=n.user,this.$nextTick((function(){r.$refs.dialog.show()}));case 19:case"end":return t.stop()}}),t,this,[[4,10]])})));function e(){return t.apply(this,arguments)}return e}(),methods:{onClose:function(){window.parent.postMessage("close","*")},onSuccess:function(t){window.parent.postMessage("success:".concat(t),"*")}}},B=I,U=(n("ace5"),Object(y["a"])(B,a,i,!1,null,null,null)),z=U.exports;s["default"].config.productionTip=!1;var L=new URLSearchParams(location.search);new s["default"]({render:function(t){return t(z,{props:{productIDs:L.getAll("p"),auth:L.get("auth")}})}}).$mount("#app")},db0d:function(t,e,n){"use strict";var r=n("4cab"),s=n.n(r);s.a},ea72:function(t,e,n){"use strict";var r=n("f716"),s=n.n(r);s.a},f716:function(t,e,n){}});
//# sourceMappingURL=recordings.24669540.js.map
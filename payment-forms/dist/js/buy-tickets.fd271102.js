(function(t){function e(e){for(var n,i,s=e[0],c=e[1],u=e[2],d=0,f=[];d<s.length;d++)i=s[d],a[i]&&f.push(a[i][0]),a[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(f.length)f.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],n=!0,s=1;s<r.length;s++){var c=r[s];0!==a[c]&&(n=!1)}n&&(o.splice(e--,1),t=i(i.s=r[0]))}return t}var n={},a={"buy-tickets":0},o=[];function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;o.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("a2b0")},"23c60":function(t,e,r){"use strict";var n=r("d635"),a=r.n(n);a.a},"2a60":function(t,e,r){},"3e62":function(t,e,r){"use strict";var n=r("bfa3"),a=r.n(n);a.a},6398:function(t,e,r){"use strict";var n=r("2a60"),a=r.n(n);a.a},"7fae":function(t,e,r){},a2b0:function(t,e,r){"use strict";r.r(e);r("744f"),r("6095"),r("6c7b"),r("d25f"),r("7514"),r("20d6"),r("f3e2"),r("1c4c"),r("6762"),r("57e7"),r("2caf"),r("cadf"),r("9865"),r("6d67"),r("e804"),r("0cd8"),r("48f8"),r("759f"),r("55dd"),r("d04f"),r("78ce"),r("8ea5"),r("0298"),r("c8ce"),r("87b3"),r("d92a"),r("217b"),r("7f7f"),r("f400"),r("7f25"),r("536b"),r("d9ab"),r("f9ab"),r("32d7"),r("25c9"),r("9f3c"),r("042e"),r("c7c6"),r("f4ff"),r("049f"),r("7872"),r("a69f"),r("0b21"),r("6c1a"),r("c7c62"),r("84b4"),r("c5f6"),r("2e37"),r("fca0"),r("7cdf"),r("ee1d"),r("b1b1"),r("87f3"),r("9278"),r("5df2"),r("04ff"),r("f751"),r("8478"),r("4504"),r("fee7"),r("1c01"),r("58b2"),r("ffc1"),r("0d6d"),r("9986"),r("8e6e"),r("25db"),r("e4f7"),r("b9a1"),r("64d5"),r("9aea"),r("db97"),r("66c8"),r("57f0"),r("165b"),r("456d"),r("cf6a"),r("fd24"),r("8615"),r("551c"),r("097d"),r("df1b"),r("2397"),r("88ca"),r("ba16"),r("d185"),r("ebde"),r("2d34"),r("f6b3"),r("2251"),r("c698"),r("a19f"),r("9253"),r("9275"),r("3b2b"),r("3846"),r("4917"),r("a481"),r("28a5"),r("386d"),r("6b54"),r("4f7f"),r("8a81"),r("ac4d"),r("8449"),r("9c86"),r("fa83"),r("48c0"),r("a032"),r("aef6"),r("d263"),r("6c37"),r("9ec8"),r("5695"),r("2fdb"),r("d0b0"),r("5df3"),r("b54a"),r("f576"),r("ed50"),r("788d"),r("14b9"),r("f386"),r("f559"),r("1448"),r("673e"),r("242a"),r("4f37"),r("c66f"),r("262f"),r("b05c"),r("34ef"),r("6aa2"),r("15ac"),r("af56"),r("b6e4"),r("9c29"),r("63d9"),r("4dda"),r("10ad"),r("c02b"),r("4795"),r("130f"),r("ac6a"),r("96cf"),r("0cdd");var n=r("2b0e"),a=r("bc3a"),o=r.n(a),i={},s=o.a.create(i);s.interceptors.request.use(function(t){return t},function(t){return Promise.reject(t)}),s.interceptors.response.use(function(t){return t},function(t){return Promise.reject(t)}),Plugin.install=function(t){t.axios=s,window.axios=s,Object.defineProperties(t.prototype,{axios:{get:function(){return s}},$axios:{get:function(){return s}}})},n["default"].use(Plugin);Plugin;var c=r("9f7b");r("2dd8");n["default"].use(c["a"]);var u=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.message?r("div",{domProps:{textContent:t._s(t.message)}}):t.products?r("div",[r("Dialog",{ref:"dialog",attrs:{ordersURL:t.ordersURL,products:t.products,stripeKey:t.stripeKey,title:t.title}}),r("b-btn",{attrs:{variant:"primary"},on:{click:t.onBuyTickets}},[t._v("Buy Tickets")])],1):t._e()},l=[],d=r("a34a"),f=r.n(d),m=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-modal",{ref:"modal",attrs:{title:t.title,"no-close-on-backdrop":"","hide-footer":""},on:{shown:t.onShown}},[t.orderID?r("Confirmation",{key:t.seq,attrs:{orderID:t.orderID},on:{close:t.onClose}}):r("OrderForm",{key:t.seq,ref:"form",attrs:{ordersURL:t.ordersURL,products:t.products,stripeKey:t.stripeKey},on:{success:t.onOrderSuccess,cancel:t.onClose}})],1)},p=[],b=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t._m(0),r("div",{attrs:{id:"connect-head"}},[t._v("Stay informed of Schola news!")]),r("div",[r("b-spinner",{directives:[{name:"show",rawName:"v-show",value:t.emailSpinner,expression:"emailSpinner"}],staticClass:"connect-done mt-1",attrs:{small:""}}),r("div",{directives:[{name:"show",rawName:"v-show",value:t.emailDone,expression:"emailDone"}],staticClass:"connect-done"},[t._v("✓")]),r("div",{staticClass:"connect-link",on:{click:t.onEmail}},[t._v("Subscribe to our email list")])],1),r("div",[r("div",{directives:[{name:"show",rawName:"v-show",value:t.facebookDone,expression:"facebookDone"}],staticClass:"connect-done"},[t._v("✓")]),r("div",{staticClass:"connect-link",on:{click:t.onFacebook}},[t._v("Follow us on Facebook")])]),r("div",[r("div",{directives:[{name:"show",rawName:"v-show",value:t.twitterDone,expression:"twitterDone"}],staticClass:"connect-done"},[t._v("✓")]),r("div",{staticClass:"connect-link",on:{click:t.onTwitter}},[t._v("Follow us on Twitter")])]),r("div",[r("b-btn",{attrs:{id:"connect-close",variant:"primary"},on:{click:function(e){return t.$emit("close")}}},[t._v("Close")])],1)])},h=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"ticket-confirm"}},[t._v("Thank you.  We have received your payment and emailed your\nticket. "),r("span",{attrs:{id:"ticket-reminder"}},[t._v("Please bring it with\nyou")]),t._v(" (printed or on phone) for admission.")])}];function y(t,e,r,n,a,o,i){try{var s=t[o](i),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function v(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var o=t.apply(e,r);function i(t){y(o,n,a,i,s,"next",t)}function s(t){y(o,n,a,i,s,"throw",t)}i(void 0)})}}var g,w={props:{orderID:Number},data:function(){return{emailDone:!1,emailSpinner:!1,facebookDone:!1,twitterDone:!1}},methods:{onEmail:function(){var t=v(f.a.mark(function t(){var e;return f.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.emailDone){t.next=2;break}return t.abrupt("return");case 2:return this.emailSpinner=!0,t.next=5,this.$axios.post("/backend/email-signup?order=".concat(this.orderID)).catch(function(t){return console.error(t),null});case 5:if(e=t.sent,e){t.next=8;break}return t.abrupt("return");case 8:e.status<400?this.emailDone=!0:console.error(e.statusText);case 9:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),onFacebook:function(){window.open("https://www.facebook.com/scholacantorum.org","_blank"),this.facebookDone=!0},onTwitter:function(){window.open("https://twitter.com/scholacantorum1","_blank"),this.twitterDone=!0}}},k=w,_=(r("6398"),r("2877")),x=Object(_["a"])(k,b,h,!1,null,null,null),C=x.exports,S=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-form",{attrs:{novalidate:""},on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[r("b-container",{staticClass:"px-0",attrs:{fluid:""}},[r("b-form-group",{staticClass:"mb-0",attrs:{label:"Ticket Quantities","label-sr-only":"",state:t.quantityState,"invalid-feedback":"How many tickets do you want?"}},[r("table",{attrs:{id:"buy-tickets-form-quantities"}},t._l(t.order.lines,function(e){return r("QtyRow",{key:e.product,ref:"qty",refInFor:!0,attrs:{name:e.productName,message:e.message,price:e.price,valid:t.quantityState},model:{value:e.quantity,callback:function(r){t.$set(e,"quantity",r)},expression:"ol.quantity"}})}),1)]),r("DonationRow",{model:{value:t.donation,callback:function(e){t.donation=e},expression:"donation"}}),r("TotalRow",{attrs:{total:t.total}}),r("div",{attrs:{id:"buy-tickets-form-divider"}}),r("b-form-group",{staticClass:"mb-1",attrs:{label:"Your name","label-sr-only":"",state:t.nameState,"invalid-feedback":"Please enter your name."}},[r("b-form-input",{attrs:{placeholder:"Your name"},model:{value:t.order.name,callback:function(e){t.$set(t.order,"name","string"===typeof e?e.trim():e)},expression:"order.name"}})],1),r("b-form-group",{staticClass:"mb-1",attrs:{label:"Email address","label-sr-only":"",state:t.emailState,"invalid-feedback":t.order.email?"This is not a valid email address.":"Please enter your email address."}},[r("b-form-input",{attrs:{type:"email",placeholder:"Email address"},on:{focus:function(e){t.emailFocused=!0},blur:function(e){t.emailFocused=!1}},model:{value:t.order.email,callback:function(e){t.$set(t.order,"email","string"===typeof e?e.trim():e)},expression:"order.email"}})],1),r("b-form-group",{staticClass:"mb-1",attrs:{label:"Card number","label-sr-only":"",state:!t.cardError&&null,"invalid-feedback":t.cardError}},[r("div",{ref:"card",staticClass:"form-control",attrs:{id:"buy-tickets-form-card"}})]),r("div",{attrs:{id:"buy-tickets-form-footer"}},[t.message?r("div",{attrs:{id:"buy-tickets-form-message"},domProps:{textContent:t._s(t.message)}}):t._e(),r("div",{attrs:{id:"buy-tickets-form-buttons"}},[r("b-btn",{attrs:{type:"button",variant:"secondary",disabled:t.submitting},on:{click:t.onCancel}},[t._v("Cancel")]),t.submitting?r("b-btn",{attrs:{id:"buy-tickets-form-pay-now",type:"submit",variant:"primary",disabled:""}},[r("b-spinner",{staticClass:"mr-1",attrs:{small:""}}),t._v("Paying...")],1):r("b-btn",{attrs:{id:"buy-tickets-form-pay-now",type:"submit",variant:"primary"}},[t._v("Pay Now")])],1)])],1)],1)},$=[],P=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("table",{attrs:{id:"buy-tickets-donation-row"}},[r("tr",[r("td",{attrs:{id:"buy-tickets-donation-label"}},[t._v("Add a donation to your order?")]),r("td",{attrs:{id:"buy-tickets-donation-amount-cell"}},[t._v("$"),r("b-form-input",{attrs:{id:"buy-tickets-donation-amount",value:t.value||"",type:"number",placeholder:"0",min:"0"},on:{input:function(e){t.$emit("input",Math.max(parseInt(e)||0),0)}}})],1)])])},q=[],D={props:{value:Number}},O=D,E=(r("d113"),Object(_["a"])(O,P,q,!1,null,null,null)),j=E.exports,F=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("tr",{staticClass:"buy-tickets-qty-row"},[t.message?[r("td",{staticClass:"buy-tickets-qty-row-name",domProps:{textContent:t._s(t.name)}}),t.message?r("td",{staticClass:"buy-tickets-qty-row-message",attrs:{colspan:"4"},domProps:{textContent:t._s(t.message)}}):t._e()]:[r("td",{staticClass:"buy-tickets-qty-row-name",attrs:{colspan:"2"},domProps:{textContent:t._s(t.name)}}),r("td",{staticClass:"buy-tickets-qty-row-qty-cell"},[r("b-form-input",{ref:"input",staticClass:"buy-tickets-qty-row-qty",attrs:{value:t.value||"",state:t.valid,type:"number",placeholder:"0",min:"0"},on:{input:function(e){t.$emit("input",Math.max(parseInt(e)||0),0)}}})],1),r("td",{staticClass:"buy-tickets-qty-row-price"},[t._v("×$"+t._s(t.price/100))]),r("td",{staticClass:"buy-tickets-qty-row-amount",domProps:{textContent:t._s(t.value?"$"+t.price*t.value/100:"")}})]],2)},T=[],A={props:{autofocus:Boolean,message:String,name:String,price:Number,value:Number,valid:Boolean},methods:{focus:function(){this.$refs.input.focus()},onQtyChange:function(t){this.$emit("input",parseInt(t.target.value)||0)}}},R=A,I=(r("3e62"),Object(_["a"])(R,F,T,!1,null,null,null)),N=I.exports,L=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"buy-tickets-form-total-row"}},[r("div",{attrs:{id:"buy-tickets-form-total"},domProps:{textContent:t._s("$"+t.total/100)}})])},U=[],M={props:{total:Number}},K=M,z=(r("b5ea"),Object(_["a"])(K,L,U,!1,null,null,null)),Z=z.exports;function B(t,e,r,n,a,o,i){try{var s=t[o](i),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function Q(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var o=t.apply(e,r);function i(t){B(o,n,a,i,s,"next",t)}function s(t){B(o,n,a,i,s,"throw",t)}i(void 0)})}}var J={components:{DonationRow:j,QtyRow:N,TotalRow:Z},props:{ordersURL:String,products:Array,stripeKey:String,title:String},data:function(){return{card:null,cardChange:null,cardFocus:!1,donation:0,elements:null,emailFocused:!1,message:null,order:{name:"",email:"",lines:[]},submitted:!1,submitting:!1}},watch:{products:{immediate:!0,handler:"createOrder"}},mounted:function(){var t=this;g||(g=Stripe(this.stripeKey)),this.elements=g.elements(),this.card=this.elements.create("card",{style:{base:{fontSize:"16px",lineHeight:1.5}}}),this.$nextTick(function(){t.card.mount(t.$refs.card),t.card.on("change",t.onCardChange),t.card.on("focus",function(){t.cardFocus=!0}),t.card.on("blur",function(){t.cardFocus=!1})})},computed:{cardError:function(){return this.cardChange&&this.cardChange.error?this.cardChange.error.message:this.submitted?!this.cardChange||this.cardChange.empty?"Please enter your card number.":this.cardFocus||this.cardChange.complete?null:"This card number is incomplete.":null},emailState:function(){return!(!this.emailFocused&&this.order.email&&!this.order.email.match(/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/))&&(!(this.submitted&&!this.order.email)&&null)},nameState:function(){return(!this.submitted||""!=this.order.name)&&null},quantityState:function(){return this.submitted?!!this.order.lines.some(function(t){return t.quantity})&&null:null},total:function(){return this.order.lines.reduce(function(t,e){return t+e.quantity*(e.price||0)},0)+100*this.donation}},methods:{createOrder:function(){var t=this;if(this.products){var e,r=0;this.order.lines=[],this.products.forEach(function(n){t.order.lines.push({product:n.id,productName:n.name,message:n.message,price:n.price,quantity:0}),n.message||(r++,e=t.order.lines[t.order.lines.length-1])}),1===r&&(e.quantity=1)}},onCancel:function(){this.$emit("cancel")},onCardChange:function(t){this.cardChange=t},onSubmit:function(){var t=Q(f.a.mark(function t(){var e,r,n,a;return f.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.submitted=!0,null===this.quantityState&&null===this.nameState&&null===this.emailState&&!this.cardError){t.next=3;break}return t.abrupt("return");case 3:return this.submitting=!0,t.next=6,g.createPaymentMethod("card",this.card,{billing_details:{name:this.order.name,email:this.order.email}});case 6:if(e=t.sent,r=e.paymentMethod,n=e.error,!n){t.next=14;break}return console.error(n),this.submitting=!1,"card_error"===n.type||"validation_error"===n.type?this.message=n.message:this.message="We’re sorry, but we're unable to process payment cards at the moment.  Please try again later, or call our office at (650) 254-1700 to order by phone.",t.abrupt("return");case 14:return t.next=16,this.$axios.post("".concat(this.ordersURL,"/api/order"),JSON.stringify({source:"public",name:this.order.name,email:this.order.email,lines:this.order.lines.filter(function(t){return t.quantity&&!t.message}).map(function(t){return{product:t.product,quantity:t.quantity,price:t.price}}),payments:[{type:"card",method:r.id,amount:this.total}]})).catch(function(t){return t});case 16:a=t.sent,this.submitting=!1,a&&a.data&&a.data.id?this.$emit("success",a.data.id):a&&a.data&&a.data.error?this.message=a.data.error:(console.error(a),this.message="We’re sorry, but we're unable to process payment cards at the moment.  Please try again later, or call our office at (650) 254-1700 to order by phone.");case 19:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),setAutoFocus:function(){this.$refs.qty[0].focus()}}},W=J,H=(r("23c60"),Object(_["a"])(W,S,$,!1,null,null,null)),Y=H.exports,G={components:{Confirmation:C,OrderForm:Y},props:{ordersURL:String,products:Array,stripeKey:String,title:String},data:function(){return{orderID:null,seq:0}},methods:{onClose:function(){this.$refs.modal.hide()},onOrderSuccess:function(t){this.orderID=t},onShown:function(){this.$refs.form.setAutoFocus()},show:function(){this.seq++,this.orderID=null,this.$refs.modal.show()}}},V=G,X=Object(_["a"])(V,m,p,!1,null,null,null),tt=X.exports;function et(t){return et="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},et(t)}function rt(t,e,r,n,a,o,i){try{var s=t[o](i),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,a)}function nt(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var o=t.apply(e,r);function i(t){rt(o,n,a,i,s,"next",t)}function s(t){rt(o,n,a,i,s,"throw",t)}i(void 0)})}}var at={props:{ordersURL:String,productIDs:Array,stripeKey:String,title:String},components:{Dialog:tt},data:function(){return{coupon:"",couponMatch:!0,message:null,products:null}},mounted:function(){var t=nt(f.a.mark(function t(){var e,r;return f.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=new URLSearchParams,this.productIDs.forEach(function(t){e.append("p",t)}),t.prev=2,t.next=5,this.$axios({method:"GET",url:"".concat(this.ordersURL,"/api/prices"),params:e});case 5:r=t.sent.data,t.next=12;break;case 8:return t.prev=8,t.t0=t["catch"](2),console.error(t.t0),t.abrupt("return");case 12:"string"===typeof r&&(this.message=r),"object"===et(r)&&(this.products=r.products,this.couponMatch=r.coupon);case 14:case"end":return t.stop()}},t,this,[[2,8]])}));function e(){return t.apply(this,arguments)}return e}(),methods:{onBuyTickets:function(){this.$refs.dialog.show()}}},ot=at,it=Object(_["a"])(ot,u,l,!1,null,null,null),st=it.exports;n["default"].config.productionTip=!1,window.addEventListener("load",function(){var t=document.getElementsByClassName("buy-tickets"),e=function(){var e=t[0],r=e.getAttribute("data-products").split(" ");new n["default"]({render:function(t){return t(st,{props:{ordersURL:e.getAttribute("data-orders-url"),productIDs:r,stripeKey:e.getAttribute("data-stripe-key"),title:e.getAttribute("data-title")}})}}).$mount(e)};while(t.length)e()})},b5ea:function(t,e,r){"use strict";var n=r("f7ff"),a=r.n(n);a.a},bfa3:function(t,e,r){},d113:function(t,e,r){"use strict";var n=r("7fae"),a=r.n(n);a.a},d635:function(t,e,r){},f7ff:function(t,e,r){}});
//# sourceMappingURL=buy-tickets.fd271102.js.map
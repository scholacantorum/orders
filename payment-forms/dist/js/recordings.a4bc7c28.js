(function(t){function e(e){for(var n,a,o=e[0],u=e[1],c=e[2],l=0,f=[];l<o.length;l++)a=o[l],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&f.push(s[a][0]),s[a]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);d&&d(e);while(f.length)f.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var t,e=0;e<i.length;e++){for(var r=i[e],n=!0,o=1;o<r.length;o++){var u=r[o];0!==s[u]&&(n=!1)}n&&(i.splice(e--,1),t=a(a.s=r[0]))}return t}var n={},s={recordings:0},i=[];function a(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=n,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var d=u;i.push([2,"chunk-vendors"]),r()})({"135e":function(t,e,r){"use strict";var n=r("2b0e"),s=r("5f5b");r("2dd8");n["default"].use(s["a"])},2:function(t,e,r){t.exports=r("cfa8")},"4cab":function(t,e,r){},6144:function(t,e,r){"use strict";var n=r("bf70"),s=r.n(n);s.a},ace5:function(t,e,r){"use strict";var n=r("ad29"),s=r.n(n);s.a},ad29:function(t,e,r){},be3b:function(t,e,r){"use strict";var n=r("2b0e"),s=r("bc3a"),i=r.n(s),a={},o=i.a.create(a);o.interceptors.request.use((function(t){return t}),(function(t){return Promise.reject(t)})),o.interceptors.response.use((function(t){return t}),(function(t){return Promise.reject(t)})),Plugin.install=function(t){t.axios=o,window.axios=o,Object.defineProperties(t.prototype,{axios:{get:function(){return o}},$axios:{get:function(){return o}}})},n["default"].use(Plugin);Plugin},bf70:function(t,e,r){},cfa8:function(t,e,r){"use strict";r.r(e);r("744f"),r("6095"),r("6c7b"),r("d25f"),r("7514"),r("20d6"),r("f3e2"),r("1c4c"),r("6762"),r("57e7"),r("2caf"),r("cadf"),r("9865"),r("6d67"),r("e804"),r("0cd8"),r("48f8"),r("759f"),r("55dd"),r("d04f"),r("78ce"),r("8ea5"),r("0298"),r("c8ce"),r("87b3"),r("d92a"),r("217b"),r("7f7f"),r("f400"),r("7f25"),r("536b"),r("d9ab"),r("f9ab"),r("32d7"),r("25c9"),r("9f3c"),r("042e"),r("c7c6"),r("f4ff"),r("049f"),r("7872"),r("a69f"),r("0b21"),r("6c1a"),r("c7c62"),r("84b4"),r("c5f6"),r("2e37"),r("fca0"),r("7cdf"),r("ee1d"),r("b1b1"),r("87f3"),r("9278"),r("5df2"),r("04ff"),r("f751"),r("8478"),r("4504"),r("fee7"),r("1c01"),r("58b2"),r("ffc1"),r("0d6d"),r("9986"),r("8e6e"),r("25db"),r("e4f7"),r("b9a1"),r("64d5"),r("9aea"),r("db97"),r("66c8"),r("57f0"),r("165b"),r("456d"),r("cf6a"),r("fd24"),r("8615"),r("551c"),r("097d"),r("df1b"),r("2397"),r("88ca"),r("ba16"),r("d185"),r("ebde"),r("2d34"),r("f6b3"),r("2251"),r("c698"),r("a19f"),r("9253"),r("9275"),r("3b2b"),r("3846"),r("4917"),r("a481"),r("28a5"),r("386d"),r("6b54"),r("4f7f"),r("8a81"),r("ac4d"),r("8449"),r("9c86"),r("fa83"),r("48c0"),r("a032"),r("aef6"),r("d263"),r("6c37"),r("9ec8"),r("5695"),r("2fdb"),r("d0b0"),r("5df3"),r("b54a"),r("f576"),r("ed50"),r("788d"),r("14b9"),r("f386"),r("f559"),r("1448"),r("673e"),r("242a"),r("4f37"),r("c66f"),r("262f"),r("b05c"),r("34ef"),r("6aa2"),r("15ac"),r("af56"),r("b6e4"),r("9c29"),r("63d9"),r("4dda"),r("10ad"),r("c02b"),r("4795"),r("130f"),r("ac6a"),r("96cf"),r("0cdd");var n,s=r("2b0e"),i=(r("be3b"),r("135e"),r("ab8b"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Dialog",{ref:"dialog",attrs:{auth:t.auth,products:t.products,stripeKey:t.stripeKey,user:t.user},on:{close:t.onClose,success:t.onSuccess}})}),a=[],o=r("a34a"),u=r.n(o),c=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-modal",{ref:"modal",attrs:{title:"Concert Recordings","no-close-on-backdrop":"","hide-footer":""},on:{shown:t.onShown,hide:t.onHide}},[r("OrderForm",{key:t.seq,ref:"form",attrs:{auth:t.auth,products:t.products,stripeKey:t.stripeKey,user:t.user},on:{success:t.onOrderSuccess,cancel:t.onClose,submitting:t.onSubmitting}})],1)},d=[],l=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-form",{attrs:{novalidate:""},on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[r("OrderLines",{attrs:{products:t.products}}),r("OrderPayment",{ref:"pmt",attrs:{send:t.onSend,stripeKey:t.stripeKey,total:t.total,user:t.user},on:{cancel:t.onCancel,submitted:t.onSubmitted,submitting:t.onSubmitting}})],1)},f=[],p=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",{staticClass:"px-0 mb-3",attrs:{fluid:""}},[r("b-form-group",{staticClass:"mb-0"},[r("table",{attrs:{id:"recordings-form-quantities"}},t._l(t.products,(function(e){return r("tr",{key:e.id,staticClass:"recordings-qty-row"},[r("td",{staticClass:"recordings-qty-row-name",domProps:{textContent:t._s(e.name)}}),r("td",{staticClass:"recordings-qty-row-amount",domProps:{textContent:t._s("$"+e.price/100)}})])})),0)]),t.products.length>1?r("div",{attrs:{id:"recordings-form-total-row"}},[r("div",{attrs:{id:"recordings-form-total"},domProps:{textContent:t._s("$"+t.total/100)}})]):t._e()],1)},h=[],m={props:{products:Array},computed:{total:function(){return this.products.reduce((function(t,e){return t+e.price}),0)}}},b=m,g=(r("db0d"),r("2877")),y=Object(g["a"])(b,p,h,!1,null,null,null),v=y.exports,w=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"show",rawName:"v-show",value:null!==t.canPR,expression:"canPR !== null"}],attrs:{id:"recordings-form-payment"}},[t.canPR?r("div",{attrs:{id:"recordings-form-use-pr-div"}},[r("label",{attrs:{id:"recordings-form-use-pr-label",for:"recordings-form-use-pr"}},[t._v("Use payment info saved "+t._s(t.deviceOrBrowser)+"?")]),r("b-form-checkbox",{attrs:{id:"recordings-form-use-pr",switch:""},model:{value:t.usePR,callback:function(e){t.usePR=e},expression:"usePR"}})],1):t._e(),r("div",{directives:[{name:"show",rawName:"v-show",value:!t.usePR,expression:"!usePR"}]},[r("b-form-group",{staticClass:"mb-1",attrs:{label:"Card number","label-sr-only":"",state:!t.cardError&&null,"invalid-feedback":t.cardError}},[r("div",{ref:"card",staticClass:"form-control",attrs:{id:"recordings-form-card"}})])],1),r("div",{attrs:{id:"recordings-form-footer"}},[t.message?r("div",{attrs:{id:"recordings-form-message"},domProps:{textContent:t._s(t.message)}}):t._e(),r("div",{attrs:{id:"recordings-form-buttons"}},[r("b-btn",{attrs:{type:"button",variant:"secondary",disabled:t.submitting},on:{click:t.onCancel}},[t._v("Cancel")]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.usePR,expression:"usePR"}],ref:"prbutton",attrs:{id:"recordings-form-prbutton"}}),!t.usePR&&t.submitting?r("b-btn",{attrs:{id:"recordings-form-pay-now",type:"submit",variant:"primary",disabled:""}},[r("b-spinner",{staticClass:"mr-1",attrs:{small:""}}),t._v("Paying...")],1):t._e(),t.usePR||t.submitting?t._e():r("b-btn",{attrs:{id:"recordings-form-pay-now",type:"submit",variant:"primary"}},[t._v("Pay "+t._s(t.total?"$"+t.total/100:"Now"))])],1)])])},P=[];function x(t,e,r,n,s,i,a){try{var o=t[i](a),u=o.value}catch(c){return void r(c)}o.done?e(u):Promise.resolve(u).then(n,s)}function C(t){return function(){var e=this,r=arguments;return new Promise((function(n,s){var i=t.apply(e,r);function a(t){x(i,n,s,a,o,"next",t)}function o(t){x(i,n,s,a,o,"throw",t)}a(void 0)}))}}var _={props:{send:Function,stripeKey:String,total:Number,user:Object},data:function(){return{canPR:null,card:null,cardChange:null,cardFocus:!1,elements:null,message:null,payreq:null,prbutton:null,submitted:!1,submitting:!1,usePR:!1}},mounted:function(){var t=C(u.a.mark((function t(){var e=this;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n||(n=Stripe(this.stripeKey)),this.elements=n.elements(),this.card=this.elements.create("card",{style:{base:{fontSize:"16px",lineHeight:1.5}},hidePostalCode:!0}),this.card.on("change",this.onCardChange),this.card.on("focus",(function(){e.cardFocus=!0})),this.card.on("blur",(function(){e.cardFocus=!1})),this.$nextTick((function(){e.card.mount(e.$refs.card)})),this.payreq=n.paymentRequest({country:"US",currency:"usd",total:{label:"Schola Cantorum Recording Order",amount:this.total},requestPayerName:!0,requestPayerEmail:!0}),t.next=10,this.payreq.canMakePayment();case 10:this.canPR=!!t.sent,this.canPR&&(this.usePR=!0,this.payreq.on("paymentmethod",this.onPaymentMethod),this.prbutton=this.elements.create("paymentRequestButton",{paymentRequest:this.payreq}),this.prbutton.on("click",this.onPRButtonClick),this.$nextTick((function(){e.prbutton.mount(e.$refs.prbutton)})));case 12:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),computed:{cardError:function(){return this.cardChange&&this.cardChange.error?this.cardChange.error.message:this.submitted?!this.cardChange||this.cardChange.empty?"Please enter your card number.":this.cardFocus||this.cardChange.complete?null:"This card number is incomplete.":null},deviceOrBrowser:function(){var t=navigator.userAgent||navigator.vendor;return/android|ipad|iphone|ipod|windows phone/i.test(t)?"on device":"in browser"}},watch:{submitted:function(){this.submitted&&this.$emit("submitted")},submitting:function(){this.$emit("submitting",this.submitting)},usePR:function(){this.submitted=!1}},methods:{focus:function(){},onCancel:function(){this.$emit("cancel")},onCardChange:function(t){this.cardChange=t},onPaymentMethod:function(){var t=C(u.a.mark((function t(e){var r;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.submitting=!0,this.card.update({disabled:!0}),t.next=4,this.send({subtype:"API ".concat(e.methodName),method:e.paymentMethod.id});case 4:r=t.sent,this.submitting=!1,this.card.update({disabled:!1}),r&&(this.message=r),e.complete(r?"fail":"success");case 9:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),onPRButtonClick:function(){this.submitted=!0,this.message=null},submit:function(){var t=C(u.a.mark((function t(){var e,r,s,i;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!==this.canPR&&!this.usePR){t.next=2;break}return t.abrupt("return");case 2:if(this.submitted=!0,this.message=null,!this.cardError){t.next=6;break}return t.abrupt("return");case 6:return this.submitting=!0,this.card.update({disabled:!0}),t.next=10,n.createPaymentMethod("card",this.card,{billing_details:{name:this.user.name,email:this.user.email,address:{line1:this.user.address,city:this.user.city,state:this.user.state,postal_code:this.user.zip}}});case 10:if(e=t.sent,r=e.paymentMethod,s=e.error,!s){t.next=19;break}return console.error(s),this.submitting=!1,this.card.update({disabled:!1}),"card_error"===s.type||"validation_error"===s.type?this.message=s.message:this.message="We’re sorry, but we're unable to process payment cards at the moment.  Please try again later, or call our office at (650) 254-1700 to order by phone.",t.abrupt("return");case 19:return t.next=21,this.send({subtype:"manual",method:r.id});case 21:i=t.sent,this.submitting=!1,this.card.update({disabled:!1}),i&&(this.message=i);case 25:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},S=_,O=(r("ea72"),Object(g["a"])(S,w,P,!1,null,null,null)),$=O.exports;function R(t,e,r,n,s,i,a){try{var o=t[i](a),u=o.value}catch(c){return void r(c)}o.done?e(u):Promise.resolve(u).then(n,s)}function k(t){return function(){var e=this,r=arguments;return new Promise((function(n,s){var i=t.apply(e,r);function a(t){R(i,n,s,a,o,"next",t)}function o(t){R(i,n,s,a,o,"throw",t)}a(void 0)}))}}var q={components:{OrderLines:v,OrderPayment:$},props:{auth:String,products:Array,stripeKey:String,user:Object},data:function(){return{submitted:!1,submitting:!1}},computed:{lines:function(){return this.products.map((function(t){return{product:t.id,price:t.price,quantity:1}}))},total:function(){return this.lines?this.lines.reduce((function(t,e){return t+e.quantity*(e.price||0)}),0):null}},watch:{submitting:function(){this.$emit("submitting",this.submitting)}},methods:{onCancel:function(){this.$emit("cancel")},onSubmit:function(){this.$refs.pmt.submit()},onSubmitted:function(){this.submitted=!0},onSubmitting:function(t){this.submitting=t},onSend:function(){var t=k(u.a.mark((function t(e){var r,n,s;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.subtype,n=e.method,t.next=3,this.$axios.post("/api/order?auth=".concat(encodeURIComponent(this.auth)),JSON.stringify({source:"members",name:this.user.name,email:this.user.email,address:this.user.address,city:this.user.city,state:this.user.state,zip:this.user.zip,member:this.user.id,lines:this.lines.filter((function(t){return t.quantity&&!t.message})).map((function(t){return{product:t.product,quantity:t.quantity,price:t.price}})),payments:[{type:"card",subtype:r,method:n,amount:this.total}]}),{headers:{"Content-Type":"application/json"}}).catch((function(t){return t}));case 3:if(s=t.sent,!(s&&s.data&&s.data.id)){t.next=7;break}return this.$emit("success",s.data.id),t.abrupt("return",null);case 7:if(!(s&&s.data&&s.data.error)){t.next=9;break}return t.abrupt("return",s.data.error);case 9:return console.error(s),t.abrupt("return","We’re sorry, but we're unable to process payment cards at the moment.  Please try again later, or call our office at (650) 254-1700 to order by phone.");case 11:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),setAutoFocus:function(){this.$refs.pmt.focus()}}},j=q,K=(r("6144"),Object(g["a"])(j,l,f,!1,null,null,null)),M=K.exports,E={components:{OrderForm:M},props:{auth:String,products:Array,stripeKey:String,user:Object},data:function(){return{seq:0,submitting:!1}},methods:{onClose:function(){this.$refs.modal.hide()},onHide:function(t){this.submitting&&t.preventDefault(),this.$emit("close")},onOrderSuccess:function(t){this.submitting=!1,this.$emit("success",t)},onShown:function(){this.$refs.form.setAutoFocus()},onSubmitting:function(t){this.submitting=t},show:function(){this.seq++,this.orderID=null,this.$refs.modal.show()}}},A=E,F=Object(g["a"])(A,c,d,!1,null,null,null),T=F.exports;function D(t,e,r,n,s,i,a){try{var o=t[i](a),u=o.value}catch(c){return void r(c)}o.done?e(u):Promise.resolve(u).then(n,s)}function N(t){return function(){var e=this,r=arguments;return new Promise((function(n,s){var i=t.apply(e,r);function a(t){D(i,n,s,a,o,"next",t)}function o(t){D(i,n,s,a,o,"throw",t)}a(void 0)}))}}var I={props:{productIDs:Array,auth:String},components:{Dialog:T},data:function(){return{products:null,stripeKey:null,user:null}},mounted:function(){var t=N(u.a.mark((function t(){var e,r,n=this;return u.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=new URLSearchParams,this.productIDs.forEach((function(t){e.append("p",t)})),e.append("auth",this.auth),t.prev=3,t.next=6,this.$axios({method:"GET",url:"/api/prices",params:e});case 6:r=t.sent.data,t.next=14;break;case 9:return t.prev=9,t.t0=t["catch"](3),console.error(t.t0),window.parent.postMessage("close","*"),t.abrupt("return");case 14:this.products=r.products,this.stripeKey=r.stripePublicKey,this.user=r.user,this.$nextTick((function(){n.$refs.dialog.show()}));case 18:case"end":return t.stop()}}),t,this,[[3,9]])})));function e(){return t.apply(this,arguments)}return e}(),methods:{onClose:function(){window.parent.postMessage("close","*")},onSuccess:function(t){window.parent.postMessage("success:".concat(t),"*")}}},B=I,U=(r("ace5"),Object(g["a"])(B,i,a,!1,null,null,null)),z=U.exports;s["default"].config.productionTip=!1;var L=new URLSearchParams(location.search);new s["default"]({render:function(t){return t(z,{props:{productIDs:L.getAll("p"),auth:L.get("auth")}})}}).$mount("#app")},db0d:function(t,e,r){"use strict";var n=r("4cab"),s=r.n(n);s.a},ea72:function(t,e,r){"use strict";var n=r("f716"),s=r.n(n);s.a},f716:function(t,e,r){}});
//# sourceMappingURL=recordings.a4bc7c28.js.map
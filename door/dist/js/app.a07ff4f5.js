(function(t){function e(e){for(var n,o,i=e[0],c=e[1],u=e[2],d=0,p=[];d<i.length;d++)o=i[d],a[o]&&p.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(p.length)p.shift()();return s.push.apply(s,u||[]),r()}function r(){for(var t,e=0;e<s.length;e++){for(var r=s[e],n=!0,i=1;i<r.length;i++){var c=r[i];0!==a[c]&&(n=!1)}n&&(s.splice(e--,1),t=o(o.s=r[0]))}return t}var n={},a={app:0},s=[];function o(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=n,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(r,n,function(e){return t[e]}.bind(null,n));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var l=c;s.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"19af":function(t,e,r){},2285:function(t,e,r){"use strict";var n=r("580c"),a=r.n(n);a.a},2906:function(t,e,r){"use strict";var n=r("f13f"),a=r.n(n);a.a},"3ab8":function(t,e,r){},4767:function(t,e,r){"use strict";var n=r("3ab8"),a=r.n(n);a.a},"4cf1":function(t,e,r){"use strict";var n=r("8ed4"),a=r.n(n);a.a},"54ee":function(t,e,r){},5666:function(t,e,r){},"56d7":function(t,e,r){"use strict";r.r(e);r("744f"),r("6c7b"),r("7514"),r("20d6"),r("1c4c"),r("6762"),r("cadf"),r("e804"),r("55dd"),r("d04f"),r("c8ce"),r("217b"),r("7f7f"),r("f400"),r("7f25"),r("536b"),r("d9ab"),r("f9ab"),r("32d7"),r("25c9"),r("9f3c"),r("042e"),r("c7c6"),r("f4ff"),r("049f"),r("7872"),r("a69f"),r("0b21"),r("6c1a"),r("c7c62"),r("84b4"),r("c5f6"),r("2e37"),r("fca0"),r("7cdf"),r("ee1d"),r("b1b1"),r("87f3"),r("9278"),r("5df2"),r("04ff"),r("f751"),r("4504"),r("fee7"),r("ffc1"),r("0d6d"),r("9986"),r("8e6e"),r("25db"),r("e4f7"),r("b9a1"),r("64d5"),r("9aea"),r("db97"),r("66c8"),r("57f0"),r("165b"),r("456d"),r("cf6a"),r("fd24"),r("8615"),r("551c"),r("097d"),r("df1b"),r("2397"),r("88ca"),r("ba16"),r("d185"),r("ebde"),r("2d34"),r("f6b3"),r("2251"),r("c698"),r("a19f"),r("9253"),r("9275"),r("3b2b"),r("3846"),r("4917"),r("a481"),r("28a5"),r("386d"),r("6b54"),r("4f7f"),r("8a81"),r("ac4d"),r("8449"),r("9c86"),r("fa83"),r("48c0"),r("a032"),r("aef6"),r("d263"),r("6c37"),r("9ec8"),r("5695"),r("2fdb"),r("d0b0"),r("5df3"),r("b54a"),r("f576"),r("ed50"),r("788d"),r("14b9"),r("f386"),r("f559"),r("1448"),r("673e"),r("242a"),r("c66f"),r("b05c"),r("34ef"),r("6aa2"),r("15ac"),r("af56"),r("b6e4"),r("9c29"),r("63d9"),r("4dda"),r("10ad"),r("c02b"),r("4795"),r("130f"),r("ac6a"),r("96cf"),r("0cdd");var n=r("2b0e"),a=r("bc3a"),s=r.n(a),o={},i=s.a.create(o);i.interceptors.request.use(function(t){return t},function(t){return Promise.reject(t)}),i.interceptors.response.use(function(t){return t},function(t){return Promise.reject(t)}),Plugin.install=function(t){t.axios=i,window.axios=i,Object.defineProperties(t.prototype,{axios:{get:function(){return i}},$axios:{get:function(){return i}}})},n["default"].use(Plugin);Plugin;var c=r("5f5b");r("ab8b"),r("2dd8");n["default"].use(c["a"]);var u=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[t._m(0),r("div",{attrs:{id:"app-body"}},[t.$store.state.auth?t.$store.state.event?r("Main"):r("ChooseEvent"):r("Login")],1)])},l=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app-header"}},[n("img",{attrs:{id:"app-header-logo",src:r("8fd5")}}),n("div",{attrs:{id:"app-header-title"}},[t._v("Schola at the Door")])])}],d=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"event"}},[r("div",{attrs:{id:"event-heading"}},[t._v("Choose Event")]),t.events?t._l(t.events,function(e){return r("div",{key:e.id,staticClass:"event-tile",domProps:{textContent:t._s(e.start.substr(0,10)+" "+e.name)},on:{click:function(r){return t.onClick(e)}}})}):r("b-spinner",{attrs:{id:"event-spinner"}})],2)},p=[],f=r("a34a"),h=r.n(f);function m(t,e,r,n,a,s,o){try{var i=t[s](o),c=i.value}catch(u){return void r(u)}i.done?e(c):Promise.resolve(c).then(n,a)}function v(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var s=t.apply(e,r);function o(t){m(s,n,a,o,i,"next",t)}function i(t){m(s,n,a,o,i,"throw",t)}o(void 0)})}}var b={data:function(){return{events:null}},mounted:function(){var t=v(h.a.mark(function t(){return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$axios.get("/api/event?future=1&freeEntries=1",{headers:{Auth:this.$store.state.auth}});case 3:this.events=t.sent.data,t.next=10;break;case 6:t.prev=6,t.t0=t["catch"](0),console.error("Error getting event list",t.t0),window.alert("Server error: ".concat(t.t0.toString()));case 10:case"end":return t.stop()}},t,this,[[0,6]])}));function e(){return t.apply(this,arguments)}return e}(),methods:{onClick:function(){var t=v(h.a.mark(function t(e){var r;return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$axios.get("/api/prices",{headers:{Auth:this.$store.state.auth},params:{event:e.id}});case 3:if(t.t0=function(t){return!t.message},r=t.sent.data.products.filter(t.t0),r.length){t.next=8;break}return window.alert("No tickets are on sale for that event."),t.abrupt("return");case 8:this.$store.commit("event",{event:e,products:r}),t.next=15;break;case 11:t.prev=11,t.t1=t["catch"](0),console.error("Error getting event products",t.t1),window.alert("Server error: ".concat(t.t1.toString()));case 15:case"end":return t.stop()}},t,this,[[0,11]])}));function e(e){return t.apply(this,arguments)}return e}()}},w=b,g=(r("9c64"),r("2877")),k=Object(g["a"])(w,d,p,!1,null,null,null),y=k.exports,C=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("form",{attrs:{id:"login"},on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[r("div",{attrs:{id:"login-header"}},[t._v("Please log in.")]),r("b-form-group",{attrs:{label:"Username","label-for":"login-username","label-cols":"4"}},[r("b-form-input",{attrs:{id:"login-username",autocomplete:"username",autofocus:"",trim:""},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}})],1),r("b-form-group",{attrs:{label:"Password","label-for":"login-password","label-cols":"4"}},[r("b-form-input",{attrs:{id:"login-password",type:"password",autocomplete:"password"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),r("b-form-group",{attrs:{id:"login-allow-row",label:"Allow","label-cols":"4"}},[r("b-form-checkbox-group",{attrs:{options:t.possiblePrivs,stacked:"",switches:""},model:{value:t.privs,callback:function(e){t.privs=e},expression:"privs"}})],1),t.error?r("div",{attrs:{id:"login-error"},domProps:{textContent:t._s(t.error)}}):t._e(),r("b-button",{attrs:{id:"login-button",type:"submit",variant:"primary",disabled:t.disabled}},[t._v("Login")])],1)},x=[];function S(t,e,r,n,a,s,o){try{var i=t[s](o),c=i.value}catch(u){return void r(u)}i.done?e(c):Promise.resolve(c).then(n,a)}function $(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var s=t.apply(e,r);function o(t){S(s,n,a,o,i,"next",t)}function i(t){S(s,n,a,o,i,"throw",t)}o(void 0)})}}var _={data:function(){return{error:null,password:null,possiblePrivs:[{value:"card",text:"Credit/debit card sales"},{value:"cash",text:"Cash/check sales"},{value:"willcall",text:"Will call"}],privs:["card","cash","willcall"],username:null}},computed:{disabled:function(){return!this.password||!this.username||!this.privs.length}},methods:{onSubmit:function(){var t=$(h.a.mark(function t(){var e,r,n;return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=new URLSearchParams,e.append("username",this.username),e.append("password",this.password),t.prev=3,t.next=6,this.$axios.post("/api/login",e);case 6:if(r=t.sent.data,r.privScanTickets){t.next=10;break}return this.error="Not authorized to use this app",t.abrupt("return");case 10:if(n={},this.privs.forEach(function(t){n[t]=!0}),!n.card&&!n.cash||r.privInPersonSales){t.next=15;break}return this.error="Not authorized to sell tickets",t.abrupt("return");case 15:if(!n.willcall||r.privViewOrders){t.next=18;break}return this.error="Not authorized to view will call list",t.abrupt("return");case 18:this.$store.commit("login",{auth:r.token,allow:n,stripeKey:r.stripePublicKey,username:this.username}),t.next=29;break;case 21:if(t.prev=21,t.t0=t["catch"](3),!t.t0.response||401!==t.t0.response.status){t.next=26;break}return this.error="Login incorrect",t.abrupt("return");case 26:return console.error("Error logging in",t.t0),this.error="Server error — login failed",t.abrupt("return");case 29:case"end":return t.stop()}},t,this,[[3,21]])}));function e(){return t.apply(this,arguments)}return e}()}},A=_,P=(r("b543"),Object(g["a"])(A,C,x,!1,null,null,null)),E=P.exports,O=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"main"}},[r("div",{attrs:{id:"main-header"},domProps:{textContent:t._s(t.eventHeader)}}),r("div",{attrs:{id:"main-body"}},["sell"===t.mode?r("SellTickets",{on:{done:t.onMenu}}):"willcall"===t.mode?r("WillCall",{on:{done:t.onMenu}}):"scan"===t.mode?r("ScanTickets",{on:{done:t.onMenu}}):r("div",{attrs:{id:"main-menu"}},[t.canSellTickets?r("b-button",{staticClass:"main-button",attrs:{variant:"primary"},on:{click:t.onSellTickets}},[t._v("Sell Tickets")]):t._e(),t.canWillCall?r("b-button",{staticClass:"main-button",attrs:{variant:"primary"},on:{click:t.onWillCall}},[t._v("Will Call")]):t._e(),r("b-button",{staticClass:"main-button",attrs:{variant:"primary"},on:{click:t.onScanTickets}},[t._v("Scan Tickets")]),r("b-button",{attrs:{id:"main-logout"},on:{click:t.onLogout}},[t._v("Logout")]),r("div",{attrs:{id:"main-stats"},domProps:{textContent:t._s(t.stats)}})],1)],1)])},T=[],q=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.selected?r("UseTickets",{attrs:{orderID:t.selected},on:{cancel:t.onUseDone,done:t.onUseDone}}):r("div",{attrs:{id:"scan"}},[t.error?r("div",{attrs:{id:"scan-error"},domProps:{textContent:t._s(t.error)}}):r("QrcodeStream",{attrs:{id:"scan-stream",track:!1},on:{init:t.onStreamInit,decode:t.onDecode}}),r("form",{attrs:{id:"scan-form"},on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[r("b-form-input",{attrs:{id:"scan-oid",autocomplete:"off",formatter:t.oidFormatter,inputmode:"numeric",pattern:"[0-9]*",placeholder:"Order #"},model:{value:t.orderID,callback:function(e){t.orderID=e},expression:"orderID"}}),r("b-button",{attrs:{id:"scan-button",type:"submit",variant:t.buttonVariant},domProps:{textContent:t._s(t.buttonLabel)}})],1)],1)},D=[],j=r("9a3e"),L=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.order?r("div",{attrs:{id:"use"}},[r("div",{attrs:{id:"use-order"}},[r("div",{attrs:{id:"use-order-name"},domProps:{textContent:t._s(t.order.name)}}),r("div",{attrs:{id:"use-order-num"},domProps:{textContent:t._s("Order #"+t.order.id)}})]),r("div",{attrs:{id:"use-classes"}},t._l(t.order.classes,function(e){return r("UseTicketClass",{key:e.name,attrs:{tclass:e},on:{change:t.onClassChange}})}),1),r("div",{attrs:{id:"use-buttons"}},[r("b-button",{staticClass:"use-button",attrs:{disabled:t.disabled,variant:"primary"},on:{click:t.onUseTickets}},[t._v("Use Tickets")]),r("b-button",{staticClass:"use-button",on:{click:function(e){return t.$emit("cancel")}}},[t._v("Cancel")])],1)]):r("b-spinner",{attrs:{id:"use-spinner"}})},U=[],J=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"useclass",class:t.classes},[r("div",{staticClass:"useclass-inner"},[r("div",{staticClass:"useclass-name",domProps:{textContent:t._s(t.tclass.name||"General Admission")}}),r("div",{staticClass:"useclass-buttons"},t._l(t.max,function(e){return r("b-button",{key:e,staticClass:"useclass-button",attrs:{disabled:t.disabled(e),variant:t.variant(e)},domProps:{textContent:t._s(e)},on:{click:function(r){return t.onClick(e)}}})}),1)])])},Q=[],M={props:{tclass:Object},computed:{classes:function(){return this.tclass.overflow?"useclass-overflow":this.tclass.name?"useclass-restricted":null},max:function(){return this.tclass.max<1e3?this.tclass.max:6*Math.ceil((this.tclass.used+1)/6)}},methods:{disabled:function(t){return t<this.tclass.min},onClick:function(t){t<this.tclass.min||(1===t&&0===this.tclass.min&&1===this.tclass.used?this.$emit("change",{tclass:this.tclass,used:0}):this.$emit("change",{tclass:this.tclass,used:t}))},variant:function(t){return t<=this.tclass.min?"dark":t<=this.tclass.used?"success":"outline-success"}}},Z=M,z=(r("f756"),Object(g["a"])(Z,J,Q,!1,null,null,null)),I=z.exports;function N(t,e,r,n,a,s,o){try{var i=t[s](o),c=i.value}catch(u){return void r(u)}i.done?e(c):Promise.resolve(c).then(n,a)}function K(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var s=t.apply(e,r);function o(t){N(s,n,a,o,i,"next",t)}function i(t){N(s,n,a,o,i,"throw",t)}o(void 0)})}}var R={components:{UseTicketClass:I},props:{orderID:String},data:function(){return{order:null}},mounted:function(){var t=K(h.a.mark(function t(){var e;return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$axios.get("/api/event/".concat(this.$store.state.event.id,"/ticket/").concat(this.orderID),{headers:{Auth:this.$store.state.auth}});case 3:if(e=t.sent.data,!e.error){t.next=8;break}return window.alert(e.error),this.$emit("cancel"),t.abrupt("return");case 8:this.order=e,t.next=19;break;case 11:if(t.prev=11,t.t0=t["catch"](0),!t.t0.response||401!==t.t0.response.status){t.next=17;break}return this.$store.commit("logout"),window.alert("Login session expired"),t.abrupt("return");case 17:console.error("Error fetching ticket usage",t.t0),window.alert("Server error: ".concat(t.t0.toString()));case 19:case"end":return t.stop()}},t,this,[[0,11]])}));function e(){return t.apply(this,arguments)}return e}(),computed:{disabled:function(){return this.order.classes.every(function(t){return t.min===t.used})}},methods:{onClassChange:function(t){var e=t.tclass,r=t.used;e.used=r,e.overflow=!1},onUseTickets:function(){var t=K(h.a.mark(function t(){var e;return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e=new URLSearchParams,e.append("scan",this.order.scan),this.order.classes.forEach(function(t){e.append("class",t.name),e.append("used",t.used)}),t.next=6,this.$axios.post("/api/event/".concat(this.$store.state.event.id,"/ticket/").concat(this.order.id),e,{headers:{Auth:this.$store.state.auth}});case 6:this.$store.commit("admitted",this.order.classes.reduce(function(t,e){return e.used-e.min},0)),this.$emit("done"),t.next=18;break;case 10:if(t.prev=10,t.t0=t["catch"](0),!t.t0.response||401!==t.t0.response.status){t.next=16;break}return this.$store.commit("logout"),window.alert("Login session expired"),t.abrupt("return");case 16:console.error("Error updating ticket usage",t.t0),window.alert("Server error: ".concat(t.t0.toString()));case 18:case"end":return t.stop()}},t,this,[[0,10]])}));function e(){return t.apply(this,arguments)}return e}()}},W=R,B=(r("4767"),Object(g["a"])(W,L,U,!1,null,null,null)),G=B.exports;function H(t,e,r,n,a,s,o){try{var i=t[s](o),c=i.value}catch(u){return void r(u)}i.done?e(c):Promise.resolve(c).then(n,a)}function V(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var s=t.apply(e,r);function o(t){H(s,n,a,o,i,"next",t)}function i(t){H(s,n,a,o,i,"throw",t)}o(void 0)})}}var F,Y={components:{QrcodeStream:j["QrcodeStream"],UseTickets:G},data:function(){return{error:null,orderID:null,selected:null}},computed:{buttonLabel:function(){return this.orderID?"Submit":"Cancel"},buttonVariant:function(){return this.orderID?"primary":"secondary"}},methods:{oidFormatter:function(t){return t.replace(/[^0-9]/g,"")},onDecode:function(t){/\/ticket\/\d\d\d\d-\d\d\d\d-\d\d\d\d$/.test(t)?this.selected=t.substr(t.length-14):window.alert("Not a Schola Cantorum order bar code")},onStreamInit:function(){var t=V(h.a.mark(function t(e){var r=this;return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.catch(function(t){"NotAllowedError"===t.name?r.error="no permission to use camera":"NotFoundError"===t.name?r.error="no camera on this device":"NotSupportedError"===t.name?r.error="secure context required (HTTPS, localhost)":"NotReadableError"===t.name?r.error="camera already in use":"OverconstrainedError"===t.name?r.error="camera is not suitable":"StreamApiNotSupportedError"===t.name?r.error="browser can't use camera":r.error="can't start QR code scanner"});case 2:case"end":return t.stop()}},t)}));function e(e){return t.apply(this,arguments)}return e}(),onSubmit:function(){this.orderID?(this.selected=this.orderID,this.orderID=null):this.$emit("done")},onUseDone:function(){this.selected=null}}},X=Y,tt=(r("fb5a"),Object(g["a"])(X,q,D,!1,null,null,null)),et=tt.exports,rt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.order?t.order.id||"other"!==t.order.payments[0].type?t.order.id?r("Receipt",{attrs:{order:t.order},on:{done:function(e){return t.$emit("done")}}}):r("PaymentCard",{attrs:{order:t.order},on:{paid:t.onPaid,cancel:function(e){return t.$emit("done")}}}):r("PaymentOther",{attrs:{order:t.order},on:{paid:function(e){return t.$emit("done")},cancel:function(e){return t.$emit("done")}}}):r("Quantities",{on:{order:t.onOrder,cancel:function(e){return t.$emit("done")}}})},nt=[],at=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("form",{attrs:{id:"paycard"},on:{submit:function(e){return e.preventDefault(),t.onChargeCard(e)}}},[r("Summary",{attrs:{order:t.order}}),r("div",{ref:"card",attrs:{id:"paycard-card"}}),r("div",{attrs:{id:"paycard-buttons"}},[r("b-button",{staticClass:"paycard-button",attrs:{type:"submit",disabled:t.processing,variant:"primary"},domProps:{textContent:t._s(t.processing?"Charging...":"Charge Card")}}),r("b-button",{staticClass:"paycard-button",attrs:{disabled:t.processing},on:{click:function(e){return t.$emit("cancel")}}},[t._v("Cancel")])],1),r("div",{attrs:{id:"paycard-error"},domProps:{textContent:t._s(t.cardError)}})],1)},st=[],ot=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"ssummary"}},[r("div",{attrs:{id:"ssummary-lines"}},t._l(t.lines,function(e,n){return r("div",{key:n,staticClass:"ssummary-line",domProps:{textContent:t._s(e)}})}),0),r("div",{attrs:{id:"ssummary-total"},domProps:{textContent:t._s("TOTAL $"+t.salesTotal/100)}})])},it=[],ct={props:{order:Object},computed:{lines:function(){var t=this;return this.order.lines.map(function(e){var r=t.$store.state.products.find(function(t){return t.id===e.product}).name;return"".concat(e.quantity,"× ").concat(r)})},salesTotal:function(){return this.order.payments[0].amount}}},ut=ct,lt=(r("b87a"),Object(g["a"])(ut,ot,it,!1,null,null,null)),dt=lt.exports;function pt(t,e,r,n,a,s,o){try{var i=t[s](o),c=i.value}catch(u){return void r(u)}i.done?e(c):Promise.resolve(c).then(n,a)}function ft(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var s=t.apply(e,r);function o(t){pt(s,n,a,o,i,"next",t)}function i(t){pt(s,n,a,o,i,"throw",t)}o(void 0)})}}var ht={components:{Summary:dt},props:{order:Object},data:function(){return{card:null,cardChange:null,cardFocus:!1,elements:null,error:null,processing:!1,submitted:!1}},mounted:function(){var t=this;F||(F=Stripe(this.$store.state.stripeKey)),this.elements=F.elements(),this.card=this.elements.create("card",{style:{base:{fontSize:"16px",lineHeight:1.5}},hidePostalCode:!0}),this.card.on("change",this.onCardChange),this.card.on("focus",function(){t.cardFocus=!0}),this.card.on("blur",function(){t.cardFocus=!1}),this.card.on("ready",function(){t.card.focus()}),this.$nextTick(function(){t.card.mount(t.$refs.card)})},computed:{cardError:function(){return this.error?this.error:this.cardChange&&this.cardChange.error?this.cardChange.error.message:this.submitted?!this.cardChange||this.cardChange.empty?"Please enter the payment card number.":this.cardFocus||this.cardChange.complete?null:"This card number is incomplete.":null}},methods:{onCardChange:function(t){this.cardChange=t},onChargeCard:function(){var t=ft(h.a.mark(function t(){var e,r,n,a;return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.submitted=!0,this.error=null,!this.cardError){t.next=4;break}return t.abrupt("return");case 4:return this.processing=!0,this.card.update({disabled:!0}),t.next=8,F.createPaymentMethod("card",this.card);case 8:if(e=t.sent,r=e.paymentMethod,n=e.error,!n){t.next=17;break}return console.error(n),this.processing=!1,this.card.update({disabled:!1}),"card_error"===n.type||"validation_error"===n.type?this.error=n.message:this.error="Server error, unable to process payment",t.abrupt("return");case 17:return this.order.payments[0].method=r.id,t.prev=18,t.next=21,this.$axios.post("/api/order",this.order,{headers:{Auth:this.$store.state.auth}});case 21:if(a=t.sent.data,!a.error){t.next=28;break}return this.processing=!1,console.error(a.error),this.card.update({disabled:!1}),this.error=a.error,t.abrupt("return");case 28:this.$store.commit("sold",{count:a.lines.reduce(function(t,e){return e.quantity+t},0),amount:a.payments[0].amount,method:"card"}),this.$emit("paid",a),t.next=42;break;case 32:if(t.prev=32,t.t0=t["catch"](18),this.processing=!1,this.card.update({disabled:!1}),!t.t0.response||401!==t.t0.response.status){t.next=40;break}return this.$store.commit("logout"),window.alert("Login session expired"),t.abrupt("return");case 40:console.error("Error placing order",t.t0),window.alert("Server error: ".concat(t.t0.toString()));case 42:case"end":return t.stop()}},t,this,[[18,32]])}));function e(){return t.apply(this,arguments)}return e}()}},mt=ht,vt=(r("a31d"),Object(g["a"])(mt,at,st,!1,null,null,null)),bt=vt.exports,wt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"payother"}},[r("Summary",{attrs:{order:t.order}}),r("div",{attrs:{id:"payother-message"},domProps:{textContent:t._s(t.confirmMessage)}}),r("div",{attrs:{id:"payother-buttons"}},[r("b-button",{staticClass:"payother-button",attrs:{disabled:t.confirmed,variant:"primary"},domProps:{textContent:t._s(t.confirmed?"Saving...":"Confirmed")},on:{click:t.onConfirmed}}),r("b-button",{staticClass:"payother-button",attrs:{disabled:t.confirmed},on:{click:function(e){return t.$emit("cancel")}}},[t._v("Cancel")])],1)],1)},gt=[];function kt(t,e,r,n,a,s,o){try{var i=t[s](o),c=i.value}catch(u){return void r(u)}i.done?e(c):Promise.resolve(c).then(n,a)}function yt(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var s=t.apply(e,r);function o(t){kt(s,n,a,o,i,"next",t)}function i(t){kt(s,n,a,o,i,"throw",t)}o(void 0)})}}var Ct={components:{Summary:dt},props:{order:Object},data:function(){return{confirmed:!1}},computed:{confirmMessage:function(){return"Cash"===this.order.payments[0].method?"Confirm you have received $".concat(this.order.payments[0].amount/100," in cash."):"Confirm you have received a check for $".concat(this.order.payments[0].amount/100,".")}},methods:{onConfirmed:function(){var t=yt(h.a.mark(function t(){var e;return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.confirmed=!0,t.prev=1,t.next=4,this.$axios.post("/api/order",this.order,{headers:{Auth:this.$store.state.auth}});case 4:if(e=t.sent.data,!e.error){t.next=7;break}throw e.error;case 7:this.$store.commit("sold",{count:e.lines.reduce(function(t,e){return e.quantity+t},0),amount:e.payments[0].amount,method:e.payments[0].method}),this.$emit("paid",e),t.next=19;break;case 11:if(t.prev=11,t.t0=t["catch"](1),!t.t0.response||401!==t.t0.response.status){t.next=17;break}return this.$store.commit("logout"),window.alert("Login session expired"),t.abrupt("return");case 17:console.error("Error placing order",t.t0),window.alert("Server error: ".concat(t.t0.toString()));case 19:case"end":return t.stop()}},t,this,[[1,11]])}));function e(){return t.apply(this,arguments)}return e}()}},xt=Ct,St=(r("4cf1"),Object(g["a"])(xt,wt,gt,!1,null,null,null)),$t=St.exports,_t=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"quantities"}},[t._l(t.$store.state.products,function(e){return r("TicketQuantity",{key:e.id,attrs:{product:e,value:t.quantities[e.id]},on:{change:t.onChange}})}),r("div",{attrs:{id:"quantities-total"},domProps:{textContent:t._s("TOTAL $"+t.salesTotal/100)}}),r("div",{attrs:{id:"quantities-buttons"}},[t.$store.state.allow.cash?r("b-button",{staticClass:"quantities-button",attrs:{disabled:!t.qtyTotal,variant:"primary"},on:{click:t.onCash}},[t._v("Cash")]):t._e(),t.$store.state.allow.cash?r("b-button",{staticClass:"quantities-button",attrs:{disabled:!t.salesTotal,variant:"primary"},on:{click:t.onCheck}},[t._v("Check")]):t._e(),t.$store.state.allow.card?r("b-button",{staticClass:"quantities-button",attrs:{disabled:!t.salesTotal,variant:"primary"},on:{click:t.onCard}},[t._v("Card")]):t._e(),r("b-button",{staticClass:"quantities-button",on:{click:function(e){return t.$emit("done")}}},[t._v("Cancel")])],1)],2)},At=[],Pt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"tqty"},[r("div",{staticClass:"tqty-name",domProps:{textContent:t._s(t.product.name)}}),r("b-button",{staticClass:"tqty-button",attrs:{variant:"primary"},on:{click:t.onDown}},[t._v("–")]),r("div",{staticClass:"tqty-qty",domProps:{textContent:t._s(t.value||"0")}}),r("b-button",{staticClass:"tqty-button",attrs:{variant:"primary"},on:{click:t.onUp}},[t._v("+")]),r("div",{class:t.priceClass,domProps:{textContent:t._s(t.priceFmt)}})],1)},Et=[],Ot={props:{product:Object,value:Number},computed:{priceClass:function(){return this.value?"tqty-amount":"tqty-price"},priceFmt:function(){return this.value?"$".concat(this.value*this.product.price/100):"$".concat(this.product.price/100)}},methods:{onDown:function(){this.value&&this.$emit("change",{product:this.product,value:this.value-1})},onUp:function(){this.$emit("change",{product:this.product,value:(this.value||0)+1})}}},Tt=Ot,qt=(r("2285"),Object(g["a"])(Tt,Pt,Et,!1,null,null,null)),Dt=qt.exports,jt={components:{TicketQuantity:Dt},data:function(){return{quantities:{}}},computed:{qtyTotal:function(){var t=this;return this.$store.state.products.reduce(function(e,r){return e+(t.quantities[r.id]||0)},0)},salesTotal:function(){var t=this;return this.$store.state.products.reduce(function(e,r){return e+r.price*(t.quantities[r.id]||0)},0)}},methods:{onCard:function(){this.sendOrder("card")},onCash:function(){this.sendOrder("other","Cash")},onCheck:function(){this.sendOrder("other","Check")},onChange:function(t){var e=t.product,r=t.value;this.$set(this.quantities,e.id,r)},sendOrder:function(t,e){var r=this;this.$emit("order",{source:"inperson",payments:[{type:t,method:e,amount:this.salesTotal}],lines:this.$store.state.products.filter(function(t){return r.quantities[t.id]}).map(function(t){return{product:t.id,quantity:r.quantities[t.id],used:r.quantities[t.id],usedAt:r.$store.state.event.id,price:t.price}})})}}},Lt=jt,Ut=(r("ecfe"),Object(g["a"])(Lt,_t,At,!1,null,null,null)),Jt=Ut.exports,Qt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("form",{attrs:{id:"receipt"},on:{submit:function(e){return e.preventDefault(),t.onSendReceipt(e)}}},[r("Summary",{attrs:{order:t.order}}),r("b-form-input",{attrs:{id:"receipt-email",type:"email",autocomplete:"off",autoCapitalize:"none",autoCorrect:!1,autofocus:"",placeholder:"Email address"},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),r("div",{attrs:{id:"receipt-buttons"}},[r("b-button",{staticClass:"receipt-button",attrs:{type:"submit",disabled:!t.validEmail||t.sending,variant:"primary"},domProps:{textContent:t._s(t.sending?"Sending...":"Send Receipt")}}),r("b-button",{staticClass:"receipt-button",on:{click:function(e){return t.$emit("done")}}},[t._v("No Receipt")])],1)],1)},Mt=[];function Zt(t,e,r,n,a,s,o){try{var i=t[s](o),c=i.value}catch(u){return void r(u)}i.done?e(c):Promise.resolve(c).then(n,a)}function zt(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var s=t.apply(e,r);function o(t){Zt(s,n,a,o,i,"next",t)}function i(t){Zt(s,n,a,o,i,"throw",t)}o(void 0)})}}var It={components:{Summary:dt},props:{order:Object},data:function(){return{email:null,sending:!1}},mounted:function(){this.email=this.order.email},computed:{validEmail:function(){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(this.email)}},methods:{onSendReceipt:function(){var t=zt(h.a.mark(function t(){return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.validEmail&&!this.sending){t.next=2;break}return t.abrupt("return");case 2:return this.sending=!0,t.prev=3,t.next=6,this.$axios.post("/api/order/".concat(this.order.id,"/sendReceipt"),null,{headers:{Auth:this.$store.state.auth},params:{email:this.email}});case 6:this.$emit("done"),t.next=18;break;case 9:if(t.prev=9,t.t0=t["catch"](3),this.sending=!1,!t.t0.response||401!==t.t0.response.status){t.next=16;break}return this.$store.commit("logout"),window.alert("Login session expired"),t.abrupt("return");case 16:console.error("Error sending receipt",t.t0),window.alert("Server error: ".concat(t.t0.toString()));case 18:case"end":return t.stop()}},t,this,[[3,9]])}));function e(){return t.apply(this,arguments)}return e}()}},Nt=It,Kt=(r("6933"),Object(g["a"])(Nt,Qt,Mt,!1,null,null,null)),Rt=Kt.exports,Wt={components:{PaymentCard:bt,PaymentOther:$t,Quantities:Jt,Receipt:Rt},data:function(){return{order:null}},methods:{onOrder:function(t){this.order=t},onPaid:function(t){this.order=t}}},Bt=Wt,Gt=Object(g["a"])(Bt,rt,nt,!1,null,null,null),Ht=Gt.exports,Vt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.orders?t.selected?r("UseTickets",{attrs:{orderID:t.selected},on:{cancel:t.onUseCancel,done:t.onUseDone}}):r("div",{attrs:{id:"willcall"}},[r("b-form-input",{attrs:{id:"willcall-search",autoCapitalize:t.none,autocomplete:"off",autoCorrect:!1,placeholder:"Search Will Call List"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),r("div",{attrs:{id:"willcall-orders"}},[r("div",t._l(t.filteredOrders,function(e){return r("div",{key:e.id,staticClass:"willcall-order",on:{click:function(r){return t.onSelect(e.id)}}},[t._v(t._s(e.name)),r("span",{staticClass:"willcall-order-num",domProps:{textContent:t._s("#"+e.id)}})])}),0)]),r("b-button",{attrs:{id:"willcall-cancel"},on:{click:function(e){return t.$emit("cancel")}}},[t._v("Cancel")])],1):r("div",{attrs:{id:"willcall-spinner"}})},Ft=[];function Yt(t,e,r,n,a,s,o){try{var i=t[s](o),c=i.value}catch(u){return void r(u)}i.done?e(c):Promise.resolve(c).then(n,a)}function Xt(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var s=t.apply(e,r);function o(t){Yt(s,n,a,o,i,"next",t)}function i(t){Yt(s,n,a,o,i,"throw",t)}o(void 0)})}}var te={components:{UseTickets:G},data:function(){return{orders:null,search:"",selected:null}},mounted:function(){var t=Xt(h.a.mark(function t(){return h.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$axios.get("/api/event/".concat(this.$store.state.event.id,"/orders"),{headers:{Auth:this.$store.state.auth}});case 3:this.orders=t.sent.data,t.next=14;break;case 6:if(t.prev=6,t.t0=t["catch"](0),!t.t0.response||401!==t.t0.response.status){t.next=12;break}return this.$store.commit("logout"),window.alert("Login session expired"),t.abrupt("return");case 12:console.error("Error getting will call list",t.t0),window.alert("Server error: ".concat(t.t0.toString()));case 14:case"end":return t.stop()}},t,this,[[0,6]])}));function e(){return t.apply(this,arguments)}return e}(),computed:{filteredOrders:function(){var t=this;return this.search.trim()?this.orders.filter(function(e){return e.name.toLowerCase().includes(t.search.toLowerCase())||parseInt(t.search)===e.id}):this.orders}},methods:{onSelect:function(t){this.selected=t},onUseCancel:function(){this.selected=null},onUseDone:function(){this.$emit("done")}}},ee=te,re=(r("76c6"),Object(g["a"])(ee,Vt,Ft,!1,null,null,null)),ne=re.exports,ae={components:{ScanTickets:et,SellTickets:Ht,WillCall:ne},data:function(){return{mode:null}},computed:{canSellTickets:function(){return this.$store.state.allow.card||this.$storestate.allow.cash},canWillCall:function(){return this.$store.state.allow.willcall},eventHeader:function(){return"".concat(this.$store.state.event.start.substr(0,10)," ").concat(this.$store.state.event.name)},stats:function(){return"Admitted ".concat(this.$store.state.admitted,", sold ").concat(this.$store.state.sold,", cash $").concat(this.$store.state.cash/100,", check $").concat(this.$store.state.check/100)}},methods:{onLogout:function(){this.$store.commit("logout")},onMenu:function(){this.mode=null},onScanTickets:function(){this.mode="scan"},onSellTickets:function(){this.mode="sell"},onWillCall:function(){this.mode="willcall"}}},se=ae,oe=(r("2906"),Object(g["a"])(se,O,T,!1,null,null,null)),ie=oe.exports,ce={components:{ChooseEvent:y,Login:E,Main:ie},mounted:function(){var t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(t,"px"))}},ue=ce,le=(r("7faf"),Object(g["a"])(ue,u,l,!1,null,null,null)),de=le.exports,pe=r("2f62");n["default"].use(pe["a"]);var fe=new pe["a"].Store({state:{allow:{},auth:null,event:null,products:null,stripeKey:null,username:null,admitted:0,sold:0,cash:0,check:0},mutations:{login:function(t,e){var r=e.allow,n=e.auth,a=e.stripeKey,s=e.username;t.allow=r,t.auth=n,t.stripeKey=a,t.username=s},logout:function(t){t.auth=t.stripeKey=t.username=t.event=t.products=null,t.allow={}},event:function(t,e){var r=e.event,n=e.products;t.event=r,t.products=n},admitted:function(t,e){t.admitted+=e},sold:function(t,e){var r=e.count,n=e.amount,a=e.method;switch(t.sold+=r,t.admitted+=r,a){case"Cash":t.cash+=n;break;case"Check":t.check+=n;break}}}}),he=fe;fe.commit("login",{auth:"9999-9999-9999",username:"sroth",allow:{card:!0,cash:!0,willcall:!0},stripeKey:"pk_test_QPwvhWbGaakWn7DGcco8J5Nd"}),n["default"].config.productionTip=!1,new n["default"]({store:he,render:function(t){return t(de)}}).$mount("#app")},"580c":function(t,e,r){},"5f3e":function(t,e,r){},6933:function(t,e,r){"use strict";var n=r("5666"),a=r.n(n);a.a},"76c6":function(t,e,r){"use strict";var n=r("e882"),a=r.n(n);a.a},"7dfc":function(t,e,r){},"7faf":function(t,e,r){"use strict";var n=r("8fba"),a=r.n(n);a.a},"8dfe":function(t,e,r){},"8ed4":function(t,e,r){},"8fba":function(t,e,r){},"8fd5":function(t,e){t.exports="data:image/png;base64,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"},"996d":function(t,e,r){},"9c64":function(t,e,r){"use strict";var n=r("7dfc"),a=r.n(n);a.a},a31d:function(t,e,r){"use strict";var n=r("19af"),a=r.n(n);a.a},a917:function(t,e,r){},b543:function(t,e,r){"use strict";var n=r("996d"),a=r.n(n);a.a},b87a:function(t,e,r){"use strict";var n=r("54ee"),a=r.n(n);a.a},e882:function(t,e,r){},ecfe:function(t,e,r){"use strict";var n=r("5f3e"),a=r.n(n);a.a},f13f:function(t,e,r){},f756:function(t,e,r){"use strict";var n=r("a917"),a=r.n(n);a.a},fb5a:function(t,e,r){"use strict";var n=r("8dfe"),a=r.n(n);a.a}});
//# sourceMappingURL=app.a07ff4f5.js.map